

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Viewer - Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./static/fonts/custom-icons.css">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        /* Toggle Info Button */
        .toggle-info-btn {
          background: white;
          border: 1px solid #e2e8f0;
          border-radius: 8px;
          padding: 10px 16px;
          margin-left: 10px;
          cursor: pointer;
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 0.95em;
          color: #2d3748;
          transition: all 0.2s ease;
        }
        .toggle-info-btn:hover {
          border-color: #4CAF50;
          background-color: #f8fafc;
          color: #4CAF50;
        }
        .toggle-info-btn i {
          font-size: 1.1em;
        }
        
        /* Two column section with transition */
        .three-column-section {
          transition: all 0.3s ease;
          position: relative;
          z-index: 1;
          height: auto;
          overflow: visible;
        }
        
        .three-column-section.hidden {
          height: 0;
          opacity: 0;
          visibility: hidden;
          margin: 0;
          padding: 0;
          transform: none;
        }
        
        /* Map container adjustments */
        .map-container {
          transition: all 0.3s ease;
          position: relative;
          z-index: 2;
        }
        
        .three-column-section:not(.hidden) + .map-container {
          margin-top: 20px;
        }
        /* ===== Dropdown Styles ===== */
        .dropdown {
            position: relative;
            display: flex;
            flex-direction: column;
            margin-right: 15px;
            min-width: 200px;
        }

        .dropdown p {
            margin: 0 0 5px 0;
            white-space: nowrap;
            font-size: 12px;
            color: #4a5568;
            font-weight: 500;
        }

        /* Dropdown Toggle Button */
        .dropdown-toggle {
            background-color: #ffffff;
            color: #2c3e50;
            padding: 10px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            min-width: 220px;
            text-align: left;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            user-select: none;
        }
        /* Dropdown Menu */
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: white;
            min-width: 240px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            border-radius: 8px;
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 4px;
            border: 1px solid #e9ecef;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.15s ease, transform 0.15s ease;
            pointer-events: none;
        }

        .dropdown.active .dropdown-menu {
            display: block;
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        /* Dropdown Menu Items */
        .dropdown-menu a {
            color: #2c3e50;
            padding: 10px 16px;
            text-decoration: none;
            display: block;
            border-bottom: 1px solid #f1f3f5;
            transition: all 0.15s ease;
            font-size: 14px;
        }

        .dropdown-menu a:hover,
        .dropdown-menu a:focus {
            background-color: #f8f9fa;
            color: #4CAF50;
        }

        .dropdown-menu a.active {
            background-color: #e8f5e9;
            color: #2e7d32;
            font-weight: 500;
            border-left: 3px solid #4CAF50;
        }

        /* Dropdown Submenu */
        .dropdown-submenu > .dropdown-submenu-content {
            display: none;
            position: absolute;
            left: 100%;
            top: 0;
            min-width: 200px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            z-index: 1001;
        }

        .dropdown-submenu:hover > .dropdown-submenu-content {
            display: block;
        }

        .dropdown-item i {
            width: 20px;
            margin-right: 10px;
            color: #4CAF50;
            text-align: center;
        }

        .dropdown-item i.fa-chevron-right {
            margin-left: auto;
            font-size: 12px;
            color: #a0aec0;
        }
        /* Toggle Switch Component */
        .toggle-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: auto;
            gap: 4px;
            margin-right: 20px;
            box-sizing: border-box;
        }

        .toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-label {
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s ease;
            line-height: 1;
        }

        .toggle-label.active {
            color: #166534;
        }

        .time-series-note {
            color: #6b7280;
            font-size: 12px;
            margin: 0 0 8px 0;
            text-align: center;
            font-style: italic;
            opacity: 0.8;
            order: -1;
            width: 100%;
        }

        /* Modern Toggle Switch */
        .toggle-switch {
            --toggle-width: 48px;
            --toggle-height: 24px;
            --toggle-handle-size: 20px;
            --toggle-padding: 2px;
            --toggle-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

            position: relative;
            display: inline-block;
            width: var(--toggle-width);
            height: var(--toggle-height);
            margin: 0;
            vertical-align: middle;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
            position: absolute;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e2e8f0;
            transition: var(--toggle-transition);
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: var(--toggle-handle-size);
            width: var(--toggle-handle-size);
            left: var(--toggle-padding);
            bottom: var(--toggle-padding);
            background-color: white;
            transition: var(--toggle-transition);
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .toggle-switch input:checked + .toggle-slider {
            background-color: #4CAF50;
        }
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(calc(var(--toggle-width) - var(--toggle-handle-size) - (2 * var(--toggle-padding))));
        }
        .toggle-switch input:focus + .toggle-slider {
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }

        .toolbar-top {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            background-color: #ffffff;
            border-radius: 20px;
        }

        /* ===== Info Box Components ===== */

        /* Three Column Section Styling */
        .three-column-section {
            display: flex;
            align-items: stretch;
            margin-bottom: 20px;
            gap: 15px;
            border-radius: 20px;
            min-height: 0;
            height: auto;
        }

        .column-left, .column-middle, .column-right {
            flex: 1;
            min-width: 0;
            min-height: 100%;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        /* Container Styles */
        .indicator-info, .theme-info, .subtheme-info {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 20px;
            width: 100%;
            padding: 25px 20px 15px;
            margin: 0;
            min-height: 120px;
            position: relative;
            text-align: left;
        }
        
        .info-box-title {
            position: absolute;
            top: 5px;
            left: 0;
            right: 0;
            font-size: 11px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 5px;
        }

        .indicator-meta-head {
          margin-top: 10px; /* needed to override the h2 styles */
          font-size: 11px;
          font-weight: 600;
          color: #6b7280;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .indicator-meta-body {
          margin-top: 10px; /* needed to override the h2 styles */
          font-size: 11px;
          color: #6b7280;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

            /* Icon Base Styles */
            .indicator-icon,
            .theme-icon,
            .subtheme-icon {
              font-size: 100px;       /* controls size */
              color: #4CAF50;
              margin: 0;
              display: inline-block;  /* or inline-flex if needed */
              line-height: 1;         /* keep line box stable */
              vertical-align: middle; /* keeps it aligned with text */
              transition: all 0.2s ease;
              opacity: 0.9;
              flex-shrink: 0;
              min-width: 60px;
            }


            /* Nested Icons */
            .indicator-icon i,
            .theme-icon i,
            .subtheme-icon i {
                font-size: 1em;
                line-height: 0;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .subtheme-icon i::before {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
                height: 100%;
            }

        /* Hover Effects */
        .indicator-info:hover .indicator-icon,
        .theme-info:hover .theme-icon {
            opacity: 1;
            transform: translateY(-1px);
        }

        /* Text Content */
        .text-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 0;
            min-width: 0;
            text-align: left;
        }

        /* Title Styles */
        .indicator-title, .theme-title, .subtheme-title {
            margin: 0; /* needed to override the h2 styles */
            color: #1a365d;
            font-size: 1.5em;
            font-weight: 600;
            line-height: 1.3;
        }
        /* Description Styles */
        .indicator-description, .theme-description, .subtheme-description {
            margin: 0;
            color: #4a5568;
            line-height: 1.6;
            font-size: 0.9em;
            max-width: 100%;
        }
        .map-container {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .loading-spinner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            border-radius: 8px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .map-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-top: 150px;
            color: #4a5568;
            width: 100%;
            height: 100%;
        }

        .placeholder-content {
            max-width: 500px;
            margin: 0 auto;
        }

        .placeholder-content i {
            font-size: 3em;
            color: #4CAF50;
            margin-bottom: 1.5rem;
        }

        .placeholder-content h3 {
            color: #2d3748;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .placeholder-content p {
            color: #718096;
            line-height: 1.6;
            margin: 0;
        }
        .map-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
        }
        .map-iframe.active {
            display: block;
        }
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        /* Dropdown Styling */
        .dropdown-toggle {
            background-color: #ffffff;
            color: #2c3e50;
            padding: 10px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            min-width: 220px;
            text-align: left;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            user-select: none;
        }
        .dropdown-toggle:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }
        .dropdown-toggle i {
            margin-left: 12px;
            font-size: 12px;
            transition: transform 0.2s ease;
        }
        .dropdown.active .dropdown-toggle i {
            transform: rotate(180deg);
        }
        .dropdown-menu {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 240px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            border-radius: 8px;
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 4px;
            border: 1px solid #e9ecef;
        }
        .dropdown.active .dropdown-menu {
            display: block;
        }

        /* iFrame Styling */
        .map-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
        }
        .map-iframe.active {
            display: block;
        }


        /* Remove duplicate dropdown styles */
        .dropdown-toggle {
            background-color: #ffffff;
            color: #2c3e50;
            padding: 10px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            text-align: left;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            user-select: none;
            box-sizing: border-box;
        }
        .dropdown-toggle:hover {
            border-color: #4CAF50;
            background-color: #f8fafc;
        }
        .dropdown-toggle:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }
        .dropdown-toggle i {
            margin-left: 12px;
            font-size: 12px;
            transition: transform 0.2s ease;
        }
        .dropdown.active .dropdown-toggle i {
            transform: rotate(180deg);
        }
        .dropdown-menu {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 240px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            border-radius: 8px;
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 4px;
            border: 1px solid #e9ecef;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.15s ease-out, transform 0.15s ease-out;
            pointer-events: none;
            left: 0;
            top: 100%;
        }

        .dropdown.active .dropdown-menu {
            display: block;
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        /* Remove fadeIn keyframes as we're using CSS transitions now */
        .dropdown-menu a {
            color: #2c3e50;
            padding: 10px 16px;
            text-decoration: none;
            display: block;
            border-bottom: 1px solid #f1f3f5;
            transition: all 0.15s ease;
            font-size: 14px;
        }
        .map-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
        }
        .map-iframe.active {
            display: block;
        }
        .dropdown-submenu > .dropdown-submenu-content {
            display: none;
            position: absolute;
            left: 100%;
            top: 0;
            min-width: 240px;
            max-height: 70vh;
            overflow-y: auto;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            z-index: 1001;
        }
        .dropdown-submenu:hover > .dropdown-submenu-content {
            display: block
        .dropdown-item i {
            width: 20px;
            margin-right: 10px;
            color: #4CAF50;
            text-align: center;
        }


        .dropdown-item i.fa-chevron-right {
            margin-left: auto;
            font-size: 12px;
            color: #a0aec0;
        }
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .dropdown {
            display: flex;
            flex-direction: row;
            align-items: center;
            margin-right: 10px;
            position: relative;
            min-width: 220px;
        }
        .dropdown p {
            margin: 0 10px 0 0;
            white-space: nowrap;
            font-size: 14px;
            color: #4a5568;
        }
        .dropdown-toggle {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px 16px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95em;
            color: #2d3748;
            transition: all 0.2s ease;
            user-select: none;
        }
        .dropdown-toggle:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }
        .dropdown-toggle:hover {
            border-color: #4CAF50;
            background-color: #f8fafc;
        }
        .dropdown-menu {
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            pointer-events: none;
        }
        .dropdown.active .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            pointer-events: auto;
        }
        .dropdown-menu a {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            color: #4a5568;
            text-decoration: none;
            transition: all 0.2s ease;
            position: relative;
        }

        /* Map iframe styles to prevent layout shift */
        .map-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .map-iframe.active {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
<base href="./">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="app-container">
      <!-- Top Toolbar with Dropdowns -->
      <div class="toolbar-top">
        <!-- Theme Dropdown -->
        <div class="dropdown" id="themeDropdown">
          <p><strong>Step 1:</strong> Choose a Theme: </p>
          <button class="dropdown-toggle" aria-haspopup="true" aria-expanded="false">
            <span>Select Theme</span>
            <i class="fas fa-chevron-down" style="font-size: 12px; margin-left: 8px; transition: transform 0.2s ease;"></i>
          </button>
          <div class="dropdown-menu" id="themeMenu" role="menu">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>

        <!-- Subtheme Dropdown (initially hidden) -->
        <div class="dropdown" id="subthemeDropdown" style="display: none;">
          <p><strong>Step 2:</strong> Choose a Sub-theme: </p>
          <button class="dropdown-toggle" aria-haspopup="true" aria-expanded="false">
            <span>Select Sub-theme</span>
            <i class="fas fa-chevron-down" style="font-size: 12px; margin-left: 8px; transition: transform 0.2s ease;"></i>
          </button>
          <div class="dropdown-menu" id="subthemeMenu" role="menu">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>

        <!-- Indicator Dropdown (initially hidden) -->
        <div class="dropdown" id="indicatorDropdown" style="display: none;">
          <p><strong>Step 3:</strong> Choose an Indicator: </p>
          <button class="dropdown-toggle" aria-haspopup="true" aria-expanded="false">
            <span>Select Indicator</span>
            <i class="fas fa-chevron-down" style="font-size: 12px; margin-left: 8px; transition: transform 0.2s ease;"></i>
          </button>
          <div class="dropdown-menu" id="indicatorMenu" role="menu">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>

        <div class="toggle-container">
          <p class="time-series-note">Note: Not all indicators have time-series data.</p>
          <div class="toggle-wrapper">
            <span id="exploreLabel" class="toggle-label active">Explore</span>
            <label class="toggle-switch">
              <input type="checkbox" id="viewToggle">
              <span class="toggle-slider"></span>
            </label>
            <span id="analyzeLabel" class="toggle-label">Analyze</span>
          </div>
        </div>
        
        <button id="toggleInfoBox" class="toggle-info-btn" title="Toggle Info Box">
          <i class="fas fa-info-circle"></i> Toggle Info
        </button>
      </div>

        <div class="three-column-section">
            <div class="column-left">
              <div class="theme-info">
                <div class="info-box-title">Theme Information</div>
                <div class="theme-icon">
                  <i class="icon icon-question"></i>
                </div>
                <div class="text-content">
                  <h2 class="theme-title">Select a Theme</h2>
                  <p class="theme-description">Choose a theme from the dropdown to view its details.</p>
                </div>
              </div>
            </div>
            <div class="column-middle">
              <div class="subtheme-info">
                <div class="info-box-title">Sub-theme Information</div>
                <div class="subtheme-icon">
                  <i class="icon icon-question"></i>
                </div>
                <div class="text-content">
                  <h2 class="subtheme-title">Select a Sub-theme</h2>
                  <p class="subtheme-description">Choose a sub-theme from the dropdown to view its details.</p>
                </div>
              </div>
            </div>
            <div class="column-right">
              <div class="indicator-info">
                <div class="info-box-title">Indicator Information</div>
                <div class="indicator-icon">
                  <i class="icon icon-question"></i>
                </div>
                <div class="text-content">
                  <h2 class="indicator-title">Select an Indicator</h2>
                  <p class="indicator-description">Choose a theme and sub-theme first, then select an indicator to view its details.</p>
                </div>
              </div>
            </div>
        </div>
    </div>

      <!-- Map Section -->
        <div class="map-container">
          <div id="mapPlaceholder" class="map-placeholder">
            <div class="placeholder-content">
              <i class="fas fa-map-marked-alt" style="font-size: 3em; margin-bottom: 20px; color: #4CAF50;"></i>
              <h3>Select a Sub-theme and Indicator</h3>
              <p>Please choose a sub-theme from the dropdown menu above, then select an indicator to view the map.</p>
            </div>
          </div>
          <div id="loadingSpinner" class="loading-spinner">
            <div class="spinner"></div>
            <p style="text-align: center; color: #4CAF50; font-weight: 500; margin-top: 15px;">Loading map data...</p>
          </div>
          <iframe id="map1" class="map-iframe" src="" style="display: none;"></iframe>
          <iframe id="map2" class="map-iframe" src="" style="display: none;"></iframe>
        </div>

      <script>
        // Toggle info box functionality
        document.addEventListener('DOMContentLoaded', function() {
          const toggleBtn = document.getElementById('toggleInfoBox');
          const infoBox = document.querySelector('.three-column-section');
          
          // Load saved preference or default to visible
          const isInfoVisible = localStorage.getItem('infoBoxVisible') !== 'false';
          if (!isInfoVisible) {
            infoBox.classList.add('hidden');
            toggleBtn.classList.add('collapsed');
          }
          
          toggleBtn.addEventListener('click', function() {
            infoBox.classList.toggle('hidden');
            const isNowHidden = infoBox.classList.contains('hidden');
            localStorage.setItem('infoBoxVisible', !isNowHidden);
            
            // Toggle icon and text
            const icon = this.querySelector('i');
            if (isNowHidden) {
              icon.className = 'fas fa-chevron-down';
              this.title = 'Show Info Box';
            } else {
              icon.className = 'fas fa-info-circle';
              this.title = 'Hide Info Box';
            }
          });
        });
        
        // Define Dropdown class first
        class Dropdown {
            constructor(element) {
                this.element = element;
                this.toggle = element.querySelector('.dropdown-toggle');
                this.menu = element.querySelector('.dropdown-menu');
                this.chevron = this.toggle.querySelector('i');
                this.isOpen = false;
                this.menuItems = Array.from(this.menu.querySelectorAll('a'));
                this.focusedIndex = -1;
                
                this.initialize();
            }
            
            initialize() {
                // Add ARIA attributes
                this.toggle.setAttribute('aria-haspopup', 'true');
                this.toggle.setAttribute('aria-expanded', 'false');
                
                // Toggle dropdown on click
                this.toggle.addEventListener('click', (e) => this.toggleDropdown(e));
                
                // Close when clicking outside
                document.addEventListener('click', (e) => this.handleOutsideClick(e));
                
                // Handle keyboard navigation
                this.toggle.addEventListener('keydown', (e) => this.handleToggleKeyDown(e));
                this.menu.addEventListener('keydown', (e) => this.handleMenuKeyDown(e));
                
                // Handle menu item interactions
                this.menuItems.forEach((item, index) => {
                    item.addEventListener('click', () => this.close());
                    item.addEventListener('focus', () => this.focusedIndex = index);
                });
            }
            
            toggleDropdown(e) {
                e.stopPropagation();
                
                if (this.isOpen) {
                    this.close();
                } else {
                    this.open();
                }
            }
            
            open() {
                if (this.isOpen) return;
                
                // Close other dropdowns first
                Dropdown.closeAll(this);
                
                // Open this dropdown
                this.element.classList.add('active');
                this.toggle.setAttribute('aria-expanded', 'true');
                this.chevron.style.transform = 'rotate(180deg)';
                this.isOpen = true;
                
                // Focus first item if available
                if (this.menuItems.length > 0) {
                    this.focusedIndex = 0;
                    this.menuItems[0].focus();
                }
            }
            
            close() {
                if (!this.isOpen) return;
                
                this.element.classList.remove('active');
                this.toggle.setAttribute('aria-expanded', 'false');
                this.chevron.style.transform = '';
                this.isOpen = false;
                this.focusedIndex = -1;
                
                // Return focus to toggle
                this.toggle.focus();
            }
            
            handleOutsideClick(e) {
                if (!this.element.contains(e.target)) {
                    this.close();
                }
            }
            
            handleToggleKeyDown(e) {
                const { key } = e;
                
                if (key === 'Enter' || key === ' ' || key === 'ArrowDown' || key === 'Down') {
                    e.preventDefault();
                    this.open();
                } else if (key === 'Escape') {
                    this.close();
                } else if (key === 'ArrowUp' || key === 'Up') {
                    e.preventDefault();
                    this.open();
                    if (this.menuItems.length > 0) {
                        this.focusedIndex = this.menuItems.length - 1;
                        this.menuItems[this.focusedIndex].focus();
                    }
                }
            }
            
            handleMenuKeyDown(e) {
                const { key } = e;
                
                switch (key) {
                    case 'Escape':
                        e.preventDefault();
                        this.close();
                        break;
                        
                    case 'ArrowDown':
                    case 'Down':
                        e.preventDefault();
                        this.focusNextItem();
                        break;
                        
                    case 'ArrowUp':
                    case 'Up':
                        e.preventDefault();
                        this.focusPrevItem();
                        break;
                        
                    case 'Home':
                        e.preventDefault();
                        this.focusItem(0);
                        break;
                        
                    case 'End':
                        e.preventDefault();
                        this.focusItem(this.menuItems.length - 1);
                        break;
                        
                    case 'Tab':
                        if (!e.shiftKey && this.focusedIndex === this.menuItems.length - 1) {
                            // Close dropdown when tabbing out of the last item
                            this.close();
                        } else if (e.shiftKey && this.focusedIndex <= 0) {
                            // Close dropdown when shift+tabbing out of the first item
                            e.preventDefault();
                            this.close();
                        }
                        break;
                }
            }
            
            focusNextItem() {
                this.focusedIndex = (this.focusedIndex + 1) % this.menuItems.length;
                this.menuItems[this.focusedIndex].focus();
            }
            
            focusPrevItem() {
                this.focusedIndex = (this.focusedIndex - 1 + this.menuItems.length) % this.menuItems.length;
                this.menuItems[this.focusedIndex].focus();
            }
            
            focusItem(index) {
                if (index >= 0 && index < this.menuItems.length) {
                    this.focusedIndex = index;
                    this.menuItems[index].focus();
                }
            }
            
            static closeAll(exceptDropdown = null) {
                document.querySelectorAll('.dropdown').forEach(dropdown => {
                    const instance = dropdown._dropdownInstance;
                    if (instance && instance !== exceptDropdown) {
                        instance.close();
                    }
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize dropdowns
            document.querySelectorAll('.dropdown').forEach(dropdown => {
                dropdown._dropdownInstance = new Dropdown(dropdown);
            });
            
            // Handle map toggle functionality
            const viewToggle = document.getElementById('viewToggle');
            const map1 = document.getElementById('map1');
            const map2 = document.getElementById('map2');
            const exploreLabel = document.getElementById('exploreLabel');
            const analyzeLabel = document.getElementById('analyzeLabel');

            viewToggle.addEventListener('change', function() {
                if (this.checked) {
                    // Switch to map2 (Analyze view)
                    map1.style.display = 'none';
                    map2.style.display = 'block';
                    exploreLabel.classList.remove('active');
                    analyzeLabel.classList.add('active');
                } else {
                    // Switch to map1 (Explore view)
                    map1.style.display = 'block';
                    map2.style.display = 'none';
                    exploreLabel.classList.add('active');
                    analyzeLabel.classList.remove('active');
                }
            });

            // Get all themes data from the template
            const themesData = [
                
                {
                    id: 'ecosystem\u002Dresileince',
                    name: '1.0 Ecosystem Resileince',
                    subthemes: [
                        
                        {
                            id: 'ecosystem\u002Dintegrity',
                            name: '1.1 Ecosystem Integrity',
                            description: 'Terrestrial ecosystems are dynamic and constantly changing. Natural habitats disrupted by human activity and/or altered by changing environmental conditions will recover, depending on the intensity and frequency of landscape disturbances. Terrestrial ecosystems that become highly fragmented and/or sustain ongoing environmental degradation can collapse in areas where adaptive capacity to respond and recover is exceeded. Assessment criteria include levels of habitat connectivity (i.e., lack of fragmentation) and relative degrees of habitat suitability (i.e., biotic value) for representative terrestrial ecosystems at a given location.',
                            icon: 'icon\u002Decosystem\u002Dintegrity',
                            indicators: [
                                
                                    
                                        {
                                            id: 'ecosystem\u002Dintegrity',
                                            title: '1.1.1 Ecosystem Integrity',
                                            description: 'Terrestrial ecosystems are dynamic and constantly changing. Natural habitats disrupted by human activity and/or altered by changing environmental conditions will recover, depending on the intensity and frequency of landscape disturbances. Terrestrial ecosystems that become highly fragmented and/or sustain ongoing environmental degradation can collapse in areas where adaptive capacity to respond and recover is exceeded. Assessment criteria include levels of habitat connectivity (i.e., lack of fragmentation) and relative degrees of habitat suitability (i.e., biotic value) for representative terrestrial ecosystems at a given location.',
                                            icon: 'icon\u002Decosystem\u002Dintegrity',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: '% change over time',
                                            theme: 'ecosystem\u002Dresileince'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'human\u002Dfootprint',
                            name: '1.2 Human Footprint',
                            description: 'The extent and degree to which human impacts reduce or damage ecosystem health and fragment natural wildland habitats. This includes both the permanent loss of wildland habitat for urban expansion (e.g., environment, roads, energy pipelines, and utility corridors) and shorter\u002Dterm landscape disturbances caused by agriculture, timber harvesting, and mining. The cumulative impact of increased human activities in these areas results in biodiversity loss and disrupts natural patterns of ecological connectivity.',
                            icon: 'icon\u002Dhuman\u002Dfootprint',
                            indicators: [
                                
                                    
                                        {
                                            id: 'human\u002Dfootprint',
                                            title: '6.2.1 Human Footprint',
                                            description: 'The extent and degree to which human impacts reduce or damage ecosystem health and fragment natural wildland habitats. This includes both the permanent loss of wildland habitat for urban expansion (e.g., environment, roads, energy pipelines, and utility corridors) and shorter\u002Dterm landscape disturbances caused by agriculture, timber harvesting, and mining. The cumulative impact of increased human activities in these areas results in biodiversity loss and disrupts natural patterns of ecological connectivity.',
                                            icon: 'icon\u002Dhuman\u002Dfootprint',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dresileince'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'climate\u002Drefugia',
                            name: '1.3 Climate Refugia',
                            description: 'Areas of the landscape that remain buffered from the most severe effects of climate change, enabling sensitive species to survive locally. They are characterized by stable microclimates, unique hydrological features, or protective topography that provides sanctuary. In the context of biodiversity and landscape ecology, refugia are vital for species survival, acting as \u0022arks\u0022 that safeguard genetic diversity and ecological communities. They serve as source populations for future re\u002Dcolonization of the surrounding landscape, thereby supporting ecosystem resilience and function.',
                            icon: 'icon\u002Dclimate\u002Dchange\u002Drefugia',
                            indicators: [
                                
                                    
                                        {
                                            id: 'climate\u002Drefugia',
                                            title: '1.3.1 Climate Refugia',
                                            description: 'Areas of the landscape that remain buffered from the most severe effects of climate change, enabling sensitive species to survive locally. They are characterized by stable microclimates, unique hydrological features, or protective topography that provides sanctuary. In the context of biodiversity and landscape ecology, refugia are vital for species survival, acting as \u0022arks\u0022 that safeguard genetic diversity and ecological communities. They serve as source populations for future re\u002Dcolonization of the surrounding landscape, thereby supporting ecosystem resilience and function.',
                                            icon: 'icon\u002Dclimate\u002Dchange\u002Drefugia',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: 'In preparation',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dresileince'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'biodiversity\u002Dconservation',
                            name: '1.4 Biodiversity Conservation',
                            description: 'Actions focused on establishing, improving, or maintaining ecosystem health and connectivity for the natural environment and for the benefit of present and future generations. Actions are focused on protecting and restoring disturbed wildland habitats to reduce the cumulative impacts of ongoing landscape disturbances and climate change. Through coordination across geographic scales and jurisdictional boundaries, these actions can help to decrease or halt current trends in biodiversity loss and disruptions to ecological connectivity.',
                            icon: 'icon\u002Dbiodiversity\u002Dconservation',
                            indicators: [
                                
                                    
                                        {
                                            id: 'habitat\u002Dprotection',
                                            title: '1.4.1 Habitat Protection',
                                            description: 'The act of safeguarding existing natural environments from harm to maintain existing levels of ecosystem health and connectivity. It is a proactive approach, emphasized in the Global Biodiversity Framework\u0027s Target 3, which calls for protecting at least 30% of land and seas by 2030 to prevent the loss of biodiversity and ecosystem services. Actions that can be taken at local and regional scales include the formal designation of protected areas managed through legislation or Indigenous law, and the designation of Other Effective Conservation Measures (OECMs).',
                                            icon: 'icon\u002Dhabitat\u002Dprotection',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dresileince'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'habitat\u002Drestoration',
                                            title: '1.4.2 Habitat Restoration',
                                            description: 'Habitat restoration is the purposeful process of assisting the recovery of degraded, damaged, or destroyed wildland habitats to improve ecosystem health and connectivity and enhance in\u002Dsitu biodiversity. It is a reactive approach, highlighted by the UN Decade on Ecosystem Restoration (2021\u002D2030), that aims to reverse damage and rebuild resilient landscapes that provide functional ecosystem services. Actions that can be taken at local and regional scales include reforestation of native trees and understory vegetation, eradicating invasive species, and reintroducing native plants and animals.',
                                            icon: 'icon\u002Dhabitat\u002Drestoration',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dresileince'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        }
                        
                    ],
                    description: 'The ability of an ecosystem to respond to a disturbance, whether natural or human\u002Dmade, by resisting damage and recovering without losing its core functions and structure. A key characteristic of a resilient ecosystem is high biodiversity, which allows it to better adapt to change. Monitoring changes in ecosystem resilience helps identify and prioritize areas in need of habitat protection and restoration.',
                    icon: 'icon\u002Decosystem\u002Dresilience'

                },
                
                {
                    id: 'ecosystem\u002Dhealth',
                    name: '2.0 Ecosystem Health',
                    subthemes: [
                        
                        {
                            id: 'habitat\u002Dvalues',
                            name: '2.1 Habitat Values',
                            description: 'The intrinsic health of terrestrial and freshwater habitats and the benefits they provide through ecosystem services, such as clean air, water filtration, pollination, carbon storage, and the regulation of natural hazard processes related to climate change. Ecosystem values are used to monitor the relative impacts of landscape changes associated with human activities over time, and to help identify and prioritize conservation efforts that protect vulnerable wildlife habitat for the broadest possible range of native species.',
                            icon: 'icon\u002D',
                            indicators: [
                                
                                    
                                        {
                                            id: 'land\u002Dcover',
                                            title: '2.1.1 Land Cover',
                                            description: 'Visible terrestrial components of the Earth\u0027s surface, which include forests, grasslands, wetlands, alpine areas and various land uses associated with human settlement, such as urban and agricultural areas and linear infrastructure. The spatial arrangement and distribution of these components serve as indicators for monitoring landscape patterns and understanding their effects on ecosystem health and integrity over time, and identifying the underlying causes of biodiversity loss.',
                                            icon: 'icon\u002Dland\u002Dcover',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'categorical values',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'ecosystem\u002Dservices',
                                            title: '2.1.2 Ecosystem Services',
                                            description: 'A subjective evaluation of the benefits that current and future generations receive from physical, chemical, and biological processes supporting the functional health and long\u002Dterm resilience of a natural ecosystem. These include provisioning (food and water), regulating (climate control and disease mitigation), supporting (nutrient cycles and pollination), and cultural services (spiritual and aesthetic value). Valuing these services involves economic methods to assign subjective worth to natural processes. However, most Indigenous worldviews view nature as kin with inherent rights, not as a commodity valued solely for human utility.',
                                            icon: 'icon\u002Decosystem\u002Dservices',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: '$CAD/hectare/year',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'habitat\u002Dsuitability',
                                            title: '2.1.3 Habitat Suitability',
                                            description: 'The capacity of terrestrial and freshwater ecosystems to provide essential life\u002Dcycle resources (food, water, shelter, breeding sites) and suitable living conditions for a species to survive and reproduce. The suitability of a given wildlife habitat is determined by site\u002Dspecific environmental variables that influence the occurrence and distribution of wildlife species. These include a wide range of biotic and abiotic variables, including the structure and composition of ecological communities within a given biogeoclimatic zone, soil moisture and nutrient levels, topographic position, temperature, slope aspect and solar insolation.',
                                            icon: 'icon\u002Dhabitat\u002Dsuitability',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative similarity (0\u002D100)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'structural\u002Dconnectivity',
                                            title: '2.1.4 Structural Connectivity',
                                            description: 'Thephysical arrangement and connectivity of habitat patches and natural landscape features(e.g., forests, water bodies) across a landscape, regardless of species\u002Dspecific behaviour. Structural connectivity is crucial for biodiversity conservation because it offers essential physical pathways that allow wildlife to move freely to access food, shelter, and breeding sites. This movement supports genetic exchange, enhances ecosystem resilience to disturbances, enables species to adjust their ranges in response to climate change, and diminishes the negative effects of habitat fragmentation.',
                                            icon: 'icon\u002D',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'habitat\u002Dthreats',
                            name: '2.2 Habitat Threats',
                            description: 'Factors or conditions that can cause harm and negatively impact the health and resilience of terrestrial and freshwater habitats. These include human activities that directly disturb the landscape (e.g., urbanization, infrastructure development, agricultural land use, and resource extraction), as well as natural hazard events like floods and wildfires. The cumulative effects of these processes lead to habitat loss and fragmentation, decreasing the natural ability of ecosystems and wildlife species to cope with and adapt to changes over time.',
                            icon: 'icon\u002Dhabitat\u002Dthreats',
                            indicators: [
                                
                                    
                                        {
                                            id: 'urbanization',
                                            title: '2.2.1 Urbanization',
                                            description: 'The conversion of natural wildland habitats into built environments to accommodate population growth and development. Examples include clearing land for residential neighbourhoods and businesses, agricultural use, resource extraction activities, and associated linear infrastructure such as roads, pipelines, and utility corridors. Direct physical consequences include the loss and fragmentation of wildland habitats and the disruption of natural ecological connectivity pathways. Indirect effects involve altered hydrology (e.g., stormwater runoff) and increased vulnerability to the spread of invasive species and biodiversity loss.',
                                            icon: 'icon\u002Durbanization',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'linear\u002Dinfrastructure',
                                            title: '2.2.2 Linear Infrastructure',
                                            description: 'Conversion of wildland habitat for the development of linear transportation and utility corridors.  These include networks of primary and secondary resource roads, rail lines, water and energy pipelines, electrical transmission lines, and related facilities. The construction of these infrastructure corridors requires extensive vegetation clearing, permanently transforming natural landscapes into developed areas. Primary threats include habitat fragmentation, disruption of wildlife movement patterns, increased access and vulnerability to invasive species and the pressures of human activity.',
                                            icon: 'icon\u002Dlinear\u002Dinfrastructure',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'categorical values',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'agricultural\u002Duse',
                                            title: '2.2.3 Agricultural Use',
                                            description: 'The conversion of wildland habitat for agricultural purposes, including land clearing for irrigated and non\u002Dirrigated crops and orchards, as well as for rangeland pasture. Direct physical impacts include loss and fragmentation of wildland habitat and species displacement, soil contamination from pesticides affecting non\u002Dtarget species, alteration of surface and groundwater flow patterns, and disruption of ecological connectivity networks through boundary fencing. Indirect effects involve changed hydrology (e.g., stormwater runoff) and increased vulnerability to invasive species and associated biodiversity loss.',
                                            icon: 'icon\u002Dagricultural\u002Duse',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'forest\u002Dharvest',
                                            title: '2.2.4 Forest Harvest',
                                            description: 'While land disturbances caused by timber harvesting will regenerate over time, there are direct and indirect consequences that can be lasting if sustainable management practices are not in place. Direct physical impacts include the loss and fragmentation of wildland habitat, species displacement, alterations in surface and groundwater flow patterns, and disruptions to ecological connectivity networks. Indirect impacts include increased susceptibility to soil compaction and erosion, modifications to natural wildlife behaviour caused by greater access for recreational activities, and the increased spread of invasive species.',
                                            icon: 'icon\u002Dfores\u002Dharvest',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'forest\u002Dthinning',
                                            title: '2.2.5 Forest Thinning',
                                            description: 'Forest thinning involves the selective removal of trees to improve the health and growth of terrestrial ecosystems and to lessen the threat of wildfire and disease. Although thinning methods cause less noticeable changes to the landscape, they can still have lasting effects. Direct physical impacts include increased light and ground temperatures, the removal of critical habitat features (e.g., dead trees, dense undergrowth), and changes to water flow and related ecosystem functions. Indirect effects include reduced habitat quality for interior\u002Ddwelling species and shifts in wildlife movement patterns.',
                                            icon: 'icon\u002Dforest\u002Dthinning',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'invasive\u002Dspecies',
                                            title: '2.2.6 Invasive Species',
                                            description: 'Invasive species are non\u002Dnative organisms introduced to new environments that can quickly establish and spread, displacing native plants and animals. Their impact on biodiversity loss includes outcompeting native species for resources, disrupting food webs, and spreading diseases, often causing population declines and extinctions. This loss of native species reduces genetic, species, and ecosystem diversity, which lowers the resilience of terrestrial ecosystems to stressors like climate change by simplifying community structures and impairing key ecological functions.',
                                            icon: 'icon\u002Dinvasive\u002Dspecies',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '',
                                            unit_of_measure: '',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'wildfire',
                                            title: '2.2.7 Wildfire',
                                            description: 'A wildfire conflagration is a severe fire event triggered by a combination of fuel (vegetation), weather conditions (such as high temperatures, strong winds, and drought), and topography (slopes). Wildfires can result in loss of life, destruction of natural habitats, and disruption of ecological connectivity networks. Although some ecosystems are adapted to fire, the increased frequency and intensity of fires can cause lasting changes in vegetationsuch as forests turning into shrublandsleading to a decline in the ecosystem\u0027s overall health, diversity, and resilience.',
                                            icon: 'icon\u002Dwildfire',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'Head Fire Intensity (kW/m)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'habitat\u002Dlosses',
                            name: '2.3 Habitat Losses',
                            description: 'Habitat loss and fragmentation are two related but distinct concepts in ecology that describe changes in the natural environment caused by the cumulative effects of landscape disturbance and climate change. Habitat loss refers to the permanent destruction, removal, or temporary degradation of terrestrial and freshwater ecosystems. Habitat fragmentation, however, involves breaking larger continuous habitats into smaller, isolated patches. Both habitat loss and fragmentation disrupt natural patterns of ecological connectivity and are the main causes of biodiversity loss.',
                            icon: 'icon\u002Dhabitat\u002Dlosses',
                            indicators: [
                                
                                    
                                        {
                                            id: 'forest\u002Dcover',
                                            title: '2.3.1 Forest Cover',
                                            description: 'Loss and fragmentation of forest ecosystems, primarily due to timber harvesting, agriculture, urbanization and wildfire, are critical indicators of habitat disturbance. Removal of tree cover and understory vegetation eliminates homes, food sources, and breeding grounds for many species, leading to habitat fragmentation. The remaining patches of forest cover become isolated, thereby disrupting natural patterns of wildlife movement and the flow of ecological processes. Fragmentation also decreases the amount of suitable habitat along forest edges and increases vulnerability to the impacts of human activity and invasive species.',
                                            icon: 'icon\u002Dforest\u002Dtypes',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'wetlands\u002Dand\u002Driparian\u002Dareas',
                                            title: '2.3.2 Wetlands \u0026 Riparian Areas',
                                            description: 'Wetlands and riparian areas (vegetation zones along rivers and streams) are highly vulnerable and critical ecosystems that provide essential ecological services and support networks of ecological connectivity for plants and animals. They are hotspots of biodiversity and support the life\u002Dcycle needs for a majority of freshwater and terrestrial species. Degradation and loss of these habitats severely impact nutrient cycles, the provision of food and clean water, the regulation of natural flood cycles and the buffering of climate change impacts. Their loss destroys critical habitats for fish, amphibians, birds, and mammals, threatening species extinction.',
                                            icon: 'icon\u002Dwetland\u002Driparian',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'mesic\u002Dvegetation',
                                            title: '2.3.3 Mesic Vegetation',
                                            description: 'Plant communities that thrive in soils with higher moisture and nutrient content in areas of groundwater discharge. These include herbs and shrubs that occur in non\u002Dforested areas at mid\u002D and lower\u002Dslope elevations and along valley bottoms. Fragmentation and loss of these habitats may lead to instability in the flow and provision of ecosystem functions (e.g., pollination, food provisioning), which are essential to a wide range of terrestrial species. It may also weaken an ecosystem\u0027s ability to cope with and adapt to disturbances caused by human activity and climate change.',
                                            icon: 'icon\u002Dmesic\u002Dvegetation',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'xeric\u002Dvegetation',
                                            title: '2.3.4 Xeric Vegetation',
                                            description: 'Plant communities that thrive in soils with lower moisture and nutrient levels. These include shrublands in non\u002Dforested areas exposed to more sunlight and in drier biogeoclimatic zones of the eastern Coast Mountains. These habitats support species that are uniquely adapted to extreme climatic conditions. Fragmentation and loss of these habitats may cause severe disruption of ecosystem functions, desertification, and reduce the capacity to cope with and adapt to disturbances caused by human activity and climate change.',
                                            icon: 'icon\u002Dxeric\u002Dvegetation',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'ecosystem\u002Dhealth'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        }
                        
                    ],
                    description: 'An ecosystem\u0027s overall condition of health in relation to a natural or relatively undisturbed reference state. It is a measure of the ecosystem\u0027s capacity to maintain its biodiversity, ecological functions, and to cope with and adapt to environmental stressors over time. Losses in ecosystem health help identify areas in need of restoration. Gains in ecosystem health over time help identify areas that contribute to biodiversity and require protection.',
                    icon: 'icon\u002Decosystem\u002Dhealth'

                },
                
                {
                    id: 'biogeoclimatic\u002Dzones',
                    name: '3.0 Biogeoclimatic Zones',
                    subthemes: [
                        
                        {
                            id: 'regional\u002Dzones',
                            name: '3.1 Regional Zones',
                            description: 'The Regional Zone component of BCs Biogeoclimatic Ecosystem Classification (BEC) is a large geographic area defined by a unique combination of climate and physiographic factors, and the dominant plant species of its old\u002Dgrowth forests (e.g., Coastal Western Hemlock Zone). It provides the \u0022big picture\u0022 framework for understanding how climate influences ecosystem development and species distribution, and allows for the development of large\u002Dscale conservation strategies, such as identifying representative ecosystems for protection and modelling the potential impacts of climate change on vegetation patterns.',
                            icon: 'icon\u002Dbiogeoclimatic\u002Drealms',
                            indicators: [
                                
                                    
                                        {
                                            id: 'regional\u002Dzones',
                                            title: '3.1.1 Regional Zones',
                                            description: 'The Regional Zone component of BCs Biogeoclimatic Ecosystem Classification (BEC) is a large geographic area defined by a unique combination of climate and physiographic factors, and the dominant plant species of its old\u002Dgrowth forests (e.g., Coastal Western Hemlock Zone). It provides the \u0022big picture\u0022 framework for understanding how climate influences ecosystem development and species distribution, and allows for the development of large\u002Dscale conservation strategies, such as identifying representative ecosystems for protection and modelling the potential impacts of climate change on vegetation patterns.',
                                            icon: 'icon\u002Dbiogeoclimatic\u002Drealms',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'categorical values',
                                            theme: 'biogeoclimatic\u002Dzones'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'site\u002Dlevel\u002Dvegetation',
                            name: '3.2 Site Level Vegetation',
                            description: 'The Site Level component of BCs Biogeoclimatic Ecosystem Classification (BEC) is defined by unique combinations of understory vegetation, soil characteristics (e.g., moisture and nutrient content), and physiographic features that influence the structure and composition of ecological communities during successional growth stages following episodes of landscape disturbance.  Identifying and mapping the distribution of site\u002Dlevel vegetation is vital for practical conservation planning, as most on\u002Dthe\u002Dground management decisions, like tree species selection for reforestation or defining specific habitat management strategies, happen at this level.',
                            icon: 'icon\u002Dsite\u002Dlevel\u002Dvegetation',
                            indicators: [
                                
                                    
                                        {
                                            id: 'site\u002Dlevel\u002Dvegetation',
                                            title: '3.2.1 Site Level Vegetation',
                                            description: 'The Site Level component of BCs Biogeoclimatic Ecosystem Classification (BEC) is defined by unique combinations of understory vegetation, soil characteristics (e.g., moisture and nutrient content), and physiographic features that influence the structure and composition of ecological communities during successional growth stages following episodes of landscape disturbance.  Identifying and mapping the distribution of site\u002Dlevel vegetation is vital for practical conservation planning, as most on\u002Dthe\u002Dground management decisions, like tree species selection for reforestation or defining specific habitat management strategies, happen at this level.',
                                            icon: 'icon\u002Dsite\u002Dlevel\u002Dvegetation',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'categorical values',
                                            theme: 'biogeoclimatic\u002Dzones'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        }
                        
                    ],
                    description: 'BCs Biogeoclimatic Ecosystem Classification (BEC) classifies broad forested landscapes and site\u002Dlevel vegetated areas based on similarities in climate, geography, and dominant plant and animal communities. Each regional zone reflects long\u002Dterm interactions between climate and biology that shape the development of distinct habitats, ecological niches, and unique assemblages of plants and animals.  In landscape ecology, they help organize the landscape into manageable areas for conservation planning and for understanding how climate change may shift ecosystems at both regional and global scales.',
                    icon: 'icon\u002Dbiogeoclimatic\u002Drealms'

                },
                
                {
                    id: 'species\u002Doccurrences',
                    name: '4.0 Species Occurrences',
                    subthemes: [
                        
                        {
                            id: 'mammals',
                            name: '4.1 Mammals',
                            description: 'Vertebrate animals of the class Mammalia are distinguished by having milk\u002Dproducing mammary glands to nourish their young, a large neocortex region in the brain, body fur or hair for insulation, and three middle ear bones that amplify sound and greatly enhance hearing sensitivity. They are endothermic (warm\u002Dblooded), breathe air, and are quadrupedal, with most mammals using four limbs for land movement. More than 80 unique species are known to inhabit the southwest Coast Mountains, ranging in size from small ground squirrels to large\u002Dranging grizzly bears.',
                            icon: 'icon\u002Dmammals',
                            indicators: [
                                
                                    
                                        {
                                            id: 'mammals',
                                            title: '4.1.1 Mammals',
                                            description: 'Vertebrate animals of the class Mammalia are distinguished by having milk\u002Dproducing mammary glands to nourish their young, a large neocortex region in the brain, body fur or hair for insulation, and three middle ear bones that amplify sound and greatly enhance hearing sensitivity. They are endothermic (warm\u002Dblooded), breathe air, and are quadrupedal, with most mammals using four limbs for land movement. More than 80 unique species are known to inhabit the southwest Coast Mountains, ranging in size from small ground squirrels to large\u002Dranging grizzly bears.',
                                            icon: 'icon\u002Dmammals',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://www.gbif.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'occurrences',
                                            theme: 'species\u002Doccurrences'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'herptiles',
                            name: '4.2 Herptiles',
                            description: 'Herptiles are an informal group of vertebrates that includes both amphibians and reptiles found in both terrestrial and freshwater environments. Amphibians (Class Amphibia) are commonly characterized by a life cycle that features an aquatic larval stage with gills and a terrestrial adult stage with lungs. Reptiles (Class Reptilia) are air\u002Dbreathing, ectothermic (cold\u002Dblooded) vertebrates with scaly skin, most of which lay eggs on land. Over 25 distinct species are documented in the southwest Coast Mountains, including various toads, frogs, salamanders, turtles, lizards, and snakes.',
                            icon: 'icon\u002Dherptiles',
                            indicators: [
                                
                                    
                                        {
                                            id: 'herptiles',
                                            title: '4.2.1 Herptiles',
                                            description: 'Herptiles are an informal group of vertebrates that includes both amphibians and reptiles found in both terrestrial and freshwater environments. Amphibians (Class Amphibia) are commonly characterized by a life cycle that features an aquatic larval stage with gills and a terrestrial adult stage with lungs. Reptiles (Class Reptilia) are air\u002Dbreathing, ectothermic (cold\u002Dblooded) vertebrates with scaly skin, most of which lay eggs on land. Over 25 distinct species are documented in the southwest Coast Mountains, including various toads, frogs, salamanders, turtles, lizards, and snakes.',
                                            icon: 'icon\u002Dherptiles',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://www.gbif.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'occurrences',
                                            theme: 'species\u002Doccurrences'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'vascular\u002Dplants',
                            name: '4.3 Vascular Plants',
                            description: 'Vascular plants (Tracheophyta) have specialized vascular tissues (xylem and phloem) for transporting water and nutrients, allowing them to grow taller and more complex than non\u002Dvascular plants. They possess true roots, stems, and leaves. Types include trees, shrubs, grasses, flowering plants (angiosperms), and ferns, many of which produce seeds. Their ability to grow larger and access resources (sunlight, water, nutrients) gives them a competitive advantage, making them the dominant group in most terrestrial ecosystems. There are 60 distinct vascular plant species documented in the southwest Coast Mountains.',
                            icon: 'icon\u002Dvascular\u002Dplants',
                            indicators: [
                                
                                    
                                        {
                                            id: 'vascular\u002Dplants',
                                            title: '4.3.1 Vascular Plants',
                                            description: 'Vascular plants (Tracheophyta) have specialized vascular tissues (xylem and phloem) for transporting water and nutrients, allowing them to grow taller and more complex than non\u002Dvascular plants. They possess true roots, stems, and leaves. Types include trees, shrubs, grasses, flowering plants (angiosperms), and ferns, many of which produce seeds. Their ability to grow larger and access resources (sunlight, water, nutrients) gives them a competitive advantage, making them the dominant group in most terrestrial ecosystems. There are 60 distinct vascular plant species documented in the southwest Coast Mountains.',
                                            icon: 'icon\u002Dvascular\u002Dplants',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://www.gbif.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'occurrences',
                                            theme: 'species\u002Doccurrences'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'non\u002Dvascular\u002Dplants',
                            name: '4.4 Non\u002DVascular Plants',
                            description: 'Non\u002Dvascular plants, known informally as bryophytes, include various mosses, liverworts, and hornworts. They lack true vascular tissue, roots, stems, and leaves, and instead use hair\u002Dlike rhizoids for anchoring and accessing water and nutrients. Bryophytes grow close to the ground, are typically found in moist environments, and reproduce through spores. They play a crucial role in ecological communities, acting as pioneer species that promote soil formation and regulate water and nutrient cycles. Over 280 unique bryophyte species have been documented in the southwest Coast Mountains.',
                            icon: 'icon\u002Dbryophytes',
                            indicators: [
                                
                                    
                                        {
                                            id: 'non\u002Dvascular\u002Dplants',
                                            title: '4.4.1 Non\u002DVascular Plants',
                                            description: 'Non\u002Dvascular plants, known informally as bryophytes, include various mosses, liverworts, and hornworts. They lack true vascular tissue, roots, stems, and leaves, and instead use hair\u002Dlike rhizoids for anchoring and accessing water and nutrients. Bryophytes grow close to the ground, are typically found in moist environments, and reproduce through spores. They play a crucial role in ecological communities, acting as pioneer species that promote soil formation and regulate water and nutrient cycles. Over 280 unique bryophyte species have been documented in the southwest Coast Mountains.',
                                            icon: 'icon\u002Dbryophytes',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://www.gbif.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'occurrences',
                                            theme: 'species\u002Doccurrences'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        }
                        
                    ],
                    description: 'Field\u002Dbased observations help identify groups of interacting populations of different species living in the same area, as well as the overall characteristics of an ecological community. These include species richness (number of species), species abundance (population sizes), trophic structure (food web relationships), and interactions such as competition and predation. In the context of biodiversity and landscape ecology, communities are vital because they form the functional units of ecosystems and play a key role in nutrient cycling, energy flow, and maintaining ecosystem stability.',
                    icon: 'icon\u002Dspecies\u002Doccurrences'

                },
                
                {
                    id: 'climate\u002Dchange\u002Drefugia',
                    name: '5.0 Climate Change Refugia',
                    subthemes: [
                        
                        {
                            id: 'macrorefugia',
                            name: '5.1 MacroRefugia',
                            description: 'Macrorefugia are large geographical regions, such as entire mountain ranges or vast forest systems, that serve as long\u002Dterm sanctuaries and offer a broad spectrum of buffered environmental conditions across the landscape. Their main function is to maintain large, viable populations and support ecosystem\u002Dlevel processes, enabling adaptation through genetic diversity and species migration over time. In the southern Coast Mountains, these include higher elevation slopes and mountain ranges, large intact watersheds, riparian corridors and associated wetlands, and extensive old\u002Dgrowth forests.',
                            icon: 'icon\u002Dmacro\u002Drefugia',
                            indicators: [
                                
                                    
                                        {
                                            id: 'macrorefugia',
                                            title: '5.1.1 MacroRefugia',
                                            description: 'Macrorefugia are large geographical regions, such as entire mountain ranges or vast forest systems, that serve as long\u002Dterm sanctuaries and offer a broad spectrum of buffered environmental conditions across the landscape. Their main function is to maintain large, viable populations and support ecosystem\u002Dlevel processes, enabling adaptation through genetic diversity and species migration over time. In the southern Coast Mountains, these include higher elevation slopes and mountain ranges, large intact watersheds, riparian corridors and associated wetlands, and extensive old\u002Dgrowth forests.',
                                            icon: 'icon\u002Dmacro\u002Drefugia',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: 'In preparation',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'climate\u002Dchange\u002Drefugia'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'microrefugia',
                            name: '5.2 MicroRefugia',
                            description: 'Microrefugia are much smaller, localized \u0022safe spots,\u0022 potentially just a cool, moist slope or a shaded canyon bottom, defined by highly localized variations in topography or hydrology. They enable the short\u002Dterm persistence of sensitive species by providing immediate shelter from extreme conditions and serving as critical stepping stones for survival across otherwise inhospitable areas. In the southern Coast Mountains, these include north\u002Dfacing slopes and shaded ravines, groundwater\u002Dfed springs and perennial streams, and topographic depressions where dense cool air flows downslope, creating cooler pockets of buffered habitat.',
                            icon: 'icon\u002Dmicro\u002Drefugia',
                            indicators: [
                                
                                    
                                        {
                                            id: 'microrefugia',
                                            title: '5.2.1 MicroRefugia',
                                            description: 'Microrefugia are much smaller, localized \u0022safe spots,\u0022 potentially just a cool, moist slope or a shaded canyon bottom, defined by highly localized variations in topography or hydrology. They enable the short\u002Dterm persistence of sensitive species by providing immediate shelter from extreme conditions and serving as critical stepping stones for survival across otherwise inhospitable areas. In the southern Coast Mountains, these include north\u002Dfacing slopes and shaded ravines, groundwater\u002Dfed springs and perennial streams, and topographic depressions where dense cool air flows downslope, creating cooler pockets of buffered habitat.',
                                            icon: 'icon\u002Dmicro\u002Drefugia',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: 'In preparation',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'climate\u002Dchange\u002Drefugia'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        }
                        
                    ],
                    description: 'Areas of the landscape that remain buffered from the most severe effects of climate change, enabling sensitive species to survive locally. They are characterized by stable microclimates, unique hydrological features, or protective topography that provides sanctuary. In the context of biodiversity and landscape ecology, refugia are vital for species survival, acting as \u0022arks\u0022 that safeguard genetic diversity and ecological communities. They serve as source populations for future re\u002Dcolonization of the surrounding landscape, thereby supporting ecosystem functions and building resilience.',
                    icon: 'icon\u002Dclimate\u002Dchange\u002Drefugia'

                },
                
                {
                    id: 'connectivity\u002Dnetwork',
                    name: '6.0 Connectivity Network',
                    subthemes: [
                        
                        {
                            id: 'priority\u002Dlinkages',
                            name: '6.1 Priority Linkages',
                            description: 'Modelled pathways of ecological connectivity that provide the most efficient movement corridors for wildlife and gene flow across the widest range of species. These pathways identify areas of least resistance for animals and plants to move between protected areas and other high\u002Dvalue habitats, including core and stepping\u002Dstone patches found in fragmented landscapes at lower elevations and in valley bottoms. Mapping these movement corridors helps guide the development of practical conservation solutions that deliver the greatest benefits for vulnerable plants and animals.',
                            icon: 'icon\u002Dpriority\u002Dlinkages',
                            indicators: [
                                
                                    
                                        {
                                            id: 'priority\u002Dlinkages',
                                            title: '6.1.1 Priority Linkages',
                                            description: 'Modelled pathways of ecological connectivity that provide the most efficient movement corridors for wildlife and gene flow across the widest range of species. These pathways identify areas of least resistance for animals and plants to move between protected areas and other high\u002Dvalue habitats, including core and stepping\u002Dstone patches found in fragmented landscapes at lower elevations and in valley bottoms. Mapping these movement corridors helps guide the development of practical conservation solutions that deliver the greatest benefits for vulnerable plants and animals.',
                                            icon: 'icon\u002Dpriority\u002Dlinkages',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'connectivity\u002Dnetwork'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'human\u002Dfootprint',
                            name: '6.2 Human Footprint',
                            description: 'The extent and degree to which human impacts reduce or damage ecosystem health and fragment natural wildland habitats. This includes both the permanent loss of wildland habitat for urban expansion (e.g., environment, roads, energy pipelines, and utility corridors) and shorter\u002Dterm landscape disturbances caused by agriculture, timber harvesting, and mining. The cumulative impact of increased human activities in these areas results in biodiversity loss and disrupts natural patterns of ecological connectivity.',
                            icon: 'icon\u002Dhuman\u002Dfootprint',
                            indicators: [
                                
                                    
                                        {
                                            id: 'human\u002Dfootprint',
                                            title: '6.2.1 Human Footprint',
                                            description: 'The extent and degree to which human impacts reduce or damage ecosystem health and fragment natural wildland habitats. This includes both the permanent loss of wildland habitat for urban expansion (e.g., environment, roads, energy pipelines, and utility corridors) and shorter\u002Dterm landscape disturbances caused by agriculture, timber harvesting, and mining. The cumulative impact of increased human activities in these areas results in biodiversity loss and disrupts natural patterns of ecological connectivity.',
                                            icon: 'icon\u002Dhuman\u002Dfootprint',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'connectivity\u002Dnetwork'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'climate\u002Dcorridors',
                            name: '6.3 Climate Corridors',
                            description: 'Defined geographical areas of natural habitat, riparian zones (areas along rivers or streams), or mountain ranges, that connect larger patches of suitable wildland habitat. They are used to develop conservation strategies to mitigate the effects of a warming climate by providing physical routes for plants and animals to migrate to more suitable, cooler environments (e.g., higher latitudes or elevations). They are a practical, on\u002Dthe\u002Dground approach to reducing habitat fragmentation and encouraging species dispersal, aiming to build landscape resilience in the southern Coast Mountains.',
                            icon: 'icon\u002Dclimate\u002Dcorridors',
                            indicators: [
                                
                                    
                                        {
                                            id: 'climate\u002Dcorridors',
                                            title: '6.3.1 Climate Corridors',
                                            description: 'Defined geographical areas of natural habitat, riparian zones (areas along rivers or streams), or mountain ranges, that connect larger patches of suitable wildland habitat. They are used to develop conservation strategies to mitigate the effects of a warming climate by providing physical routes for plants and animals to migrate to more suitable, cooler environments (e.g., higher latitudes or elevations). They are a practical, on\u002Dthe\u002Dground approach to reducing habitat fragmentation and encouraging species dispersal, aiming to build landscape resilience in the southern Coast Mountains.',
                                            icon: 'icon\u002Dclimate\u002Dcorridors',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: 'In preparation',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'connectivity\u002Dnetwork'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'connectivity\u002Dconservation',
                            name: '6.4 Connectivity Conservation',
                            description: 'Actions focused on establishing, improving, or maintaining ecosystem health and connectivity for the natural environment and for the benefit of present and future generations. Actions are focused on protecting and restoring disturbed wildland habitats to reduce the cumulative impacts of ongoing landscape disturbances and climate change. Through coordination across geographic scales and jurisdictional boundaries, these actions can help to decrease or halt current trends in biodiversity loss and disruptions to ecological connectivity.',
                            icon: 'icon\u002Dconnectivity\u002Dconservation',
                            indicators: [
                                
                                    
                                        {
                                            id: 'connectivity\u002Doverlay',
                                            title: '6.4.1 Connectivity Overlay',
                                            description: 'A planning tool based on the results of an ecological connectivity network design that establishes specific management criteria for identifying compatible and incompatible land use activities according to their potential to cause adverse effects on animal movement within a designated wildlife corridor. The overlay references existing zoning or resource development plans and prioritizes the management of more restrictive land\u002Duse activities within zones with moderate and high connectivity potential. It also helps to increase awareness and understanding of ecological connectivity within the community.',
                                            icon: 'icon\u002Dconnectivity\u002Doverlay',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'categorical values',
                                            theme: 'connectivity\u002Dnetwork'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'effective\u002Dmeans',
                                            title: '6.4.2 Effective Means',
                                            description: 'Formal and informal mechanisms that planners and decision\u002Dmakers can use to implement a wildlife connectivity action plan. Formal mechanisms include legal means, such as Indigenous law, legislation, and land\u002Duse regulations\u003B policy instruments, such as official community plans rooted in law\u003B bylaws\u003B binding agreements\u003B partnerships\u003B or contracts. Informal mechanisms encompass voluntary agreements or partnerships not governed by law, incentive programs, negotiation outcomes, cultural customs, or recognized traditional values. Spatial representations of these mechanisms help guide practical solutions for implementing a wildlife connectivity action plan.',
                                            icon: 'icon\u002Deffective\u002Dmeans',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'categorical values',
                                            theme: 'connectivity\u002Dnetwork'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        }
                        
                    ],
                    description: 'An integrated system of core habitats (protected areas and other undisturbed natural regions) connected by wildlife corridors that are established through coordinated land\u002Duse policies to enable the unimpeded movement of species and the flow of natural processes. They are essential for maintaining and restoring ecological functions, halting current trends in biodiversity loss, and assisting species in adapting to changing environmental conditions in fragmented wildland habitats affected by landscape disturbance and climate change.',
                    icon: 'icon\u002Dconnectivity\u002Dnetwork'

                },
                
                {
                    id: 'habitat\u002Dcores',
                    name: '7.0 Habitat Cores',
                    subthemes: [
                        
                        {
                            id: 'large\u002Drange\u002Dspecies',
                            name: '7.1 Large\u002DRange Species',
                            description: 'Habitat cores for large\u002Dranging focal species reflect access to food, water, and shelter\u003B reproduction\u003B social structures (i.e., solitary or group behaviour)\u003B environmental stability\u003B and the ability to move freely within a given home range.  For carnivore species in this grouping, habitat cores are characterized by mean home\u002Drange sizes of 30 square kilometres, minimum stepping\u002Dstone patch sizes of 13,000 hectares, and dispersal distances of 60 kilometres.',
                            icon: 'icon\u002Dlarge\u002Drange\u002Dspecies',
                            indicators: [
                                
                                    
                                        {
                                            id: 'grizzly\u002Dbear',
                                            title: '8.1.1 Grizzly Bear',
                                            description: 'Grizzly bears are powerful omnivores with a distinctive shoulder hump and long claws adapted for digging. Their fur ranges from dark brown to blonde, often tipped with silver giving them a grizzled appearance. Found in remote mountainous and forested regions of British Columbia, grizzlies are solitary and wide\u002Dranging, with home ranges spanning hundreds of square kilometres. They play a keystone role in ecosystems by turning over soil, dispersing seeds, and regulating prey populations. Grizzlies enter hibernation from November to April, and like black bears, undergo hyperphagia in late summer, consuming up to 20,000 calories daily to prepare for winter.',
                                            icon: 'icon\u002Dgrizzly\u002Dbear',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'wolverine',
                                            title: '8.1.2 Wolverine',
                                            description: 'Wolverines are muscular, solitary carnivores known for their strength, endurance, and tenacity. With thick dark fur, pale facial masks, and bushy tails, they resemble small bears more than weasels. Wolverines are adapted to cold, snowy environments and can travel vast distances in search of food. They scavenge large carcasses and hunt small prey, often caching food. In BC, wolverines are rare and elusive, with populations concentrated in remote mountainous terrain. Their low reproductive rate and sensitivity to disturbance make them vulnerable to habitat fragmentation.',
                                            icon: 'icon\u002Dwolverine',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'pacific\u002Dfisher',
                                            title: '8.1.3 Pacific Fisher',
                                            description: 'The Pacific fisher is a secretive, forest\u002Ddwelling carnivore in the weasel family. With sleek chocolate\u002Dbrown fur, bushy tails, and agile bodies, fishers are expert climbers and hunters. They prefer mature coniferous forests with complex canopy structure and abundant windfall timber, which they use for denning and hunting. Despite their name, fishers do not eat fish and instead they prey on squirrels, snowshoe hares, and even porcupines. In BC, Pacific fishers are rare and declining, with fragmented populations in the southern interior and isolated individuals in the Sea\u002Dto\u002Dsky region.',
                                            icon: 'icon\u002Dpacific\u002Dfisher',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'canada\u002Dlynx',
                                            title: '8.1.4 Canada Lynx',
                                            description: 'Canada lynx are elusive, long\u002Dlegged felines with tufted ears, short tails, and thick fur adapted to cold climates. Their oversized paws act like snowshoes, allowing them to hunt effectively in deep snow. Lynx are highly specialised predators of snowshoe hares, and their populations fluctuate in tandem with hare abundance. Solitary and nocturnal, lynx prefer dense coniferous forests with abundant understory and minimal human disturbance. In BC, they are most common in interior plateaus and northern ranges, with scattered individuals in the Sea\u002Dto\u002DSky region.',
                                            icon: 'icon\u002Dcanada\u002Dlynx',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'medium\u002Drange\u002Dspecies',
                            name: '7.2 Medium\u002DRange Species',
                            description: 'Habitat cores for large\u002Dranging focal species reflect access to food, water, and shelter\u003B reproduction\u003B social structures (i.e., solitary or group behaviour)\u003B environmental stability\u003B and the ability to move freely within a given home range.  For carnivore species in this grouping, habitat cores are characterized by mean home\u002Drange sizes of 30 square kilometres, minimum stepping\u002Dstone patch sizes of 13,000 hectares, and dispersal distances of 60 kilometres.',
                            icon: 'icon\u002Dmoderate\u002Drange\u002Dspecies',
                            indicators: [
                                
                                    
                                        {
                                            id: 'black\u002Dbear',
                                            title: '8.2.1 Black Bear',
                                            description: 'Black bears are adaptable mammals found throughout British Columbias diverse landscapes, from coastal rainforests to alpine slopes. They have a stocky build, short claws, and a keen sense of smell that helps them forage for berries, insects, and fish. Their coat can range in colour from jet black to cinnamon or even creamy white. They play a vital role in maintaining healthy ecosystems by dispersing seeds and recycling nutrients. Unless food is abundant, black bears typically hibernate from November to March. From September, bears enter hyperphagia, during which their calorie intake increases from 5,000 to 20,000 per day.',
                                            icon: 'icon\u002Dblack\u002Dbear',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'mountain\u002Dgoat',
                                            title: '8.2.2 Mountain Goat',
                                            description: 'Mountain goats are iconic alpine specialists, adapted to life on steep cliffs and rugged terrain. With thick white coats, black horns, and muscular builds, they navigate vertical landscapes with ease. Their split hooves and rough pads provide grip on rock faces, allowing them to escape predators and access high\u002Delevation forage. Found throughout BCs mountainous regions, mountain goats are sensitive to disturbance and require undisturbed escape terrain. Their seasonal movements follow snowlines and forage availability, often descending in winter and ascending in summer.',
                                            icon: 'icon\u002Dmountain\u002Dgoat',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://doi.org/10.3389/fenvs.2022.958596\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'black\u002Dtailed\u002Ddeer',
                                            title: '8.2.3 Black\u002DTailed Deer',
                                            description: 'Black\u002Dtailed deer, also known as mule deer, are browsers adapted to BCs coastal rainforests. With reddish\u002Dbrown summer coats and darker winter pelage, theyre named for their distinctive black\u002Dtipped tails. These deer are crepuscular, feeding at dawn and dusk, and rely on dense understory for cover. Males grow forked antlers annually, shedding them in late winter. Black\u002Dtailed deer are a vital prey species for cougars and wolves and play a key role in shaping forest vegetation through browsing.',
                                            icon: 'icon\u002Dblack\u002Dtailed\u002Ddeer',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'small\u002Drange\u002Dspecies',
                            name: '7.3 Small\u002DRange Species',
                            description: 'Habitat cores for small\u002Dranging focal species reflect life\u002Dcycle needs such as access to food, water, and shelter\u003B reproduction\u003B social structures (i.e., solitary or group behaviour)\u003B environmental stability\u003B and the ability to move freely within a given home range.  For species in this grouping, habitat cores are characterized by mean home\u002Drange sizes of less than 1 square kilometre, minimum stepping\u002Dstone patch sizes of 350 hectares, and dispersal distances of 6 kilometres.',
                            icon: 'icon\u002Dsmall\u002Drange\u002Dspecies',
                            indicators: [
                                
                                    
                                        {
                                            id: 'hoary\u002Dmarmot',
                                            title: '8.3.1 Hoary Marmot',
                                            description: 'Hoary marmots are large, social ground squirrels known for their loud whistles, which gave Whistler its name, and communal sunbathing. Their thick silver\u002Dgrey fur and white muzzle give them a frosted appearance, hence the name hoary. Marmots live in colonies and dig extensive burrow systems in alpine meadows, where they forage during the short summer season. They hibernate for up to eight months, relying on fat reserves built during peak forage. In BC, hoary marmots are common in high\u002Delevation habitats, including the Garibaldi and Tantalus ranges.',
                                            icon: 'icon\u002Dhoary\u002Dmarmot',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'douglass\u002Dsquirrel',
                                            title: '8.3.2 Douglass Squirrel',
                                            description: 'he Douglas squirrel is a lively, vocal tree squirrel with a rusty brown back, pale belly, bushy tail, and a distinct black side stripe in summer. Known for its rapid movements and sharp chatter, it plays a key role in forest ecosystems by dispersing seeds and spores. These squirrels are active year\u002Dround, caching cones and mushrooms around the forest. They prefer mature coniferous forests, especially those dominated by Douglas\u002Dfir, hemlock, and pine. Their nests, called dreys, are built in tree cavities or branch forks and lined with moss and bark.',
                                            icon: 'icon\u002Ddouglass\u002Dsquirell',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'yellow\u002Dpine\u002Dchipmunk',
                                            title: '8.3.3 Yellow\u002DPine Chipmunk',
                                            description: 'The yellow\u002Dpine chipmunk is a small, agile rodent with bold facial stripes and a reddish\u002Dbrown back. Chipmunks are excellent climbers and often forage in shrubs and low trees. Theyre active during the day, storing food in cheek pouches and caching seeds for winter. Yellow\u002Dpine chipmunks hibernate in colder months, emerging in spring to breed and forage. Their vocalisations include high\u002Dpitched chips and trills used for alarm and territory defence.',
                                            icon: 'icon\u002Dyellow\u002Dpine\u002Dchipmunk',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'garter\u002Dsnake',
                                            title: '8.3.4 Garter Snake',
                                            description: 'Garter snakes are slender, non\u002Dvenomous reptiles with distinctive longitudinal stripes, typically yellow, green, or blue, running down their dark bodies. Males are considerably smaller than females. They are highly adaptable and often found near water, where they hunt amphibians and small fish. Garter snakes are active during the day and hibernate communally in winter, sometimes in large numbers. They give birth to live young and use their keen sense of smell and tongue\u002Dflicking to locate prey. In BC, several subspecies exist, including the common western garter and the more aquatic valley garter. In the Sea\u002Dto\u002DSky the most frequently seen is the common garter snake.',
                                            icon: 'icon\u002Dgarter\u002Dsnake',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'pacific\u002Dtree\u002Dfrog',
                                            title: '8.3.5 Pacific Tree Frog',
                                            description: 'The Pacific Tree frog is a tiny, vocal amphibian known for its loud nighttime calls and remarkable colour variation, ranging from green to brown, with a dark eye stripe. Despite their name, they are technically tree frogs and possess toe pads for climbing. These frogs breed in shallow wetlands and temporary pools, laying eggs in clusters attached to vegetation. After metamorphosis, juveniles disperse into upland habitats. Pacific chorus frogs are active from spring through fall and hibernate in leaf litter or underground during winter.',
                                            icon: 'icon\u002Dpacific\u002Dtree\u002Dfrog',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'micro\u002Drange\u002Dspecies',
                            name: '7.4 Micro\u002DRange Species',
                            description: 'Habitat cores for small\u002Dranging focal species reflect life\u002Dcycle needs such as access to food, water, and shelter\u003B reproduction\u003B social structures (i.e., solitary or group behaviour)\u003B environmental stability\u003B and the ability to move freely within a given home range.  For species in this grouping, habitat cores are characterized by patch sizes of 2 \u002D5 hectares and mean dispersal distances of up to 1 kilometre.',
                            icon: 'icon\u002Dmicro\u002Drange\u002Dspecies',
                            indicators: [
                                
                                    
                                        {
                                            id: 'western\u002Dtoad',
                                            title: '8.3.6 Western Toad',
                                            description: 'Western toads are stout amphibians with dry, bumpy skin and a pale stripe running down their back. Unlike frogs, they walk rather than hop, and their parotoid glands behind the eyes secrete mild toxins to deter predators. These toads breed in shallow wetlands and lay long strings of eggs. After metamorphosis, juveniles disperse into upland habitats, often traveling hundreds of meters from breeding sites. Western toads are active from spring to fall and hibernate underground during winter.',
                                            icon: 'icon\u002Dwestern\u002Dtoad',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'red\u002Dlegged\u002Dfrog',
                                            title: '8.3.7 Red\u002DLegged Frog',
                                            description: 'Northern red\u002Dlegged frogs are slender, long\u002Dlegged amphibians with smooth skin and a reddish hue on their hind limbs. Their eyes are positioned slightly forward, and they often have a faint gold wash on their back. These frogs breed early in the year, sometimes while snow still lingers, laying egg masses in cool, still wetlands. After metamorphosis, juveniles disperse into moist forest habitats, where they forage and overwinter under logs or in root channels. They are sensitive to habitat disturbance and require cool, shaded environments to thrive.',
                                            icon: 'icon\u002Dred\u002Dlegged\u002Dfrog',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'ensatina\u002Dsalamander',
                                            title: '8.3.8 Ensatina Salamander',
                                            description: 'The Ensatina salamander is a small, lungless amphibian with smooth skin and a constricted tail base. Its coloration varies from reddish\u002Dbrown to orange or gray, often with mottled patterns. Unlike many amphibians, Ensatinas do not have an aquatic larval stage, they hatch directly from eggs laid in moist terrestrial microhabitats. These salamanders breathe through their skin and require cool, damp environments to survive. They are nocturnal and secretive, sheltering under logs, leaf litter, and rocks during the day.',
                                            icon: 'icon\u002Densatina\u002Dsalamander',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'northwestern\u002Dsalamander',
                                            title: '8.3.9 Northwestern Salamander',
                                            description: 'The Northwestern salamander is a secretive amphibian with smooth brown skin and large parotoid glands behind the eyes. Adults are terrestrial, while larvae and juvenile individuals remain aquatic. They breed in still or slow\u002Dmoving water, laying egg masses attached to submerged vegetation. After metamorphosis, juveniles disperse into moist forest habitats, often sheltering under logs, leaf litter, or in burrows. These salamanders are long\u002Dlived and sensitive to habitat disturbance, especially changes in moisture and temperature.',
                                            icon: 'icon\u002Dnorthwest\u002Dsalamander',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'long\u002Dtoed\u002Dsalamander',
                                            title: '8.3.10 Long\u002DToed Salamander',
                                            description: 'The long\u002Dtoed salamander is a slender amphibian with a dark body, yellow or olive dorsal stripe, and notably elongated fourth toe on the hind foot. It breeds in shallow ponds and lakes, laying eggs singly or in small clusters attached to submerged vegetation. Larvae are aquatic, while adults are terrestrial and nocturnal, sheltering under logs, rocks, and leaf litter. These salamanders are active in spring and fall, often migrating short distances between breeding and foraging habitats. Their permeable skin makes them highly sensitive to pollutants and moisture loss.',
                                            icon: 'icon\u002Dlong\u002Dtoed\u002Dsalamander',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'northern\u002Dalligator\u002Dlizard',
                                            title: '8.3.11 Northern Alligator Lizard',
                                            description: 'Alligator lizards are slender, long\u002Dbodied reptiles with rough scales and a distinctive fold along each side of the body. Their coloration ranges from olive to brown with dark bands, and have the ability to drop their tails to escape predators. These lizards are secretive and often found under logs, rocks, or leaf litter. They are active during warm months and hibernate in winter. Alligator lizards give birth to live young rather than laying eggs, a rare trait among reptiles in BC.',
                                            icon: 'icon\u002Daligator\u002Dlizard',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'habitat\u002Dcores'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        }
                        
                    ],
                    description: 'Protected areas and other relatively undisturbed wildland habitats are defined by stable environmental conditions and healthy terrestrial ecosystem functions that sustain the life\u002Dcycle needs of diverse animal and plant communities. Wildlife habitat cores range from large home\u002Drange areas to smaller stepping\u002Dstone patches within fragmented landscapes. They serve as resource hubs within broader networks of ecological connectivity, offering refuge for larger animals migrating along movement pathways between areas of higher habitat suitability, as well as for resident populations of smaller animals.',
                    icon: 'icon\u002Dquestion'

                },
                
                {
                    id: 'wildlife\u002Dcorridors',
                    name: '8.0 Wildlife Corridors',
                    subthemes: [
                        
                        {
                            id: 'large\u002Drange\u002Dlinkages',
                            name: '8.1 Large\u002DRange Linkages',
                            description: 'Corridors for large\u002Dranging mammals (e.g., grizzly bears, wolves, elk, lynx) are usually extensive, often spanning landscape\u002Dscale or transboundary natural pathways that link large core habitats. These corridors must be wide enough to support not only movement but also normal behaviour, providing adequate food, water, and cover to reduce human\u002Dwildlife conflict and facilitate genetic exchange over broad areas. At local and regional levels, they help guide the placement of crossing structures, such as highway overpasses and underpasses, to ensure safe passage across human\u002Dmade barriers.',
                            icon: 'icon\u002Dlarge\u002Drange\u002Dcorridors',
                            indicators: [
                                
                                    
                                        {
                                            id: 'grizzly\u002Dbear',
                                            title: '8.1.1 Grizzly Bear',
                                            description: 'Grizzly bears are powerful omnivores with a distinctive shoulder hump and long claws adapted for digging. Their fur ranges from dark brown to blonde, often tipped with silver giving them a grizzled appearance. Found in remote mountainous and forested regions of British Columbia, grizzlies are solitary and wide\u002Dranging, with home ranges spanning hundreds of square kilometres. They play a keystone role in ecosystems by turning over soil, dispersing seeds, and regulating prey populations. Grizzlies enter hibernation from November to April, and like black bears, undergo hyperphagia in late summer, consuming up to 20,000 calories daily to prepare for winter.',
                                            icon: 'icon\u002Dgrizzly\u002Dbear',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'wolverine',
                                            title: '8.1.2 Wolverine',
                                            description: 'Wolverines are muscular, solitary carnivores known for their strength, endurance, and tenacity. With thick dark fur, pale facial masks, and bushy tails, they resemble small bears more than weasels. Wolverines are adapted to cold, snowy environments and can travel vast distances in search of food. They scavenge large carcasses and hunt small prey, often caching food. In BC, wolverines are rare and elusive, with populations concentrated in remote mountainous terrain. Their low reproductive rate and sensitivity to disturbance make them vulnerable to habitat fragmentation.',
                                            icon: 'icon\u002Dwolverine',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'pacific\u002Dfisher',
                                            title: '8.1.3 Pacific Fisher',
                                            description: 'The Pacific fisher is a secretive, forest\u002Ddwelling carnivore in the weasel family. With sleek chocolate\u002Dbrown fur, bushy tails, and agile bodies, fishers are expert climbers and hunters. They prefer mature coniferous forests with complex canopy structure and abundant windfall timber, which they use for denning and hunting. Despite their name, fishers do not eat fish and instead they prey on squirrels, snowshoe hares, and even porcupines. In BC, Pacific fishers are rare and declining, with fragmented populations in the southern interior and isolated individuals in the Sea\u002Dto\u002Dsky region.',
                                            icon: 'icon\u002Dpacific\u002Dfisher',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'canada\u002Dlynx',
                                            title: '8.1.4 Canada Lynx',
                                            description: 'Canada lynx are elusive, long\u002Dlegged felines with tufted ears, short tails, and thick fur adapted to cold climates. Their oversized paws act like snowshoes, allowing them to hunt effectively in deep snow. Lynx are highly specialised predators of snowshoe hares, and their populations fluctuate in tandem with hare abundance. Solitary and nocturnal, lynx prefer dense coniferous forests with abundant understory and minimal human disturbance. In BC, they are most common in interior plateaus and northern ranges, with scattered individuals in the Sea\u002Dto\u002DSky region.',
                                            icon: 'icon\u002Dcanada\u002Dlynx',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://terradapt.org/\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'medium\u002Drange\u002Dlinkages',
                            name: '8.2 Medium\u002DRange Linkages',
                            description: 'Corridors for medium\u002Dranging mammals (e.g., bobcats, coyotes, foxes, deer) connect smaller, more numerous core habitat patches. They can be natural features, such as riparian buffers or hedgerows, and must be protected from intense edge effects including invasive species, human activity, and high predation risk. These medium\u002Drange corridors help identify bottlenecks (pinch points) and guide land management solutions to improve passage (e.g., fencing or vegetation restoration). Locally, they support connections between green spaces in settled areas and regional connectivity corridors.',
                            icon: 'icon\u002Dmoderate\u002Drange\u002Dcorridors',
                            indicators: [
                                
                                    
                                        {
                                            id: 'black\u002Dbear',
                                            title: '8.2.1 Black Bear',
                                            description: 'Black bears are adaptable mammals found throughout British Columbias diverse landscapes, from coastal rainforests to alpine slopes. They have a stocky build, short claws, and a keen sense of smell that helps them forage for berries, insects, and fish. Their coat can range in colour from jet black to cinnamon or even creamy white. They play a vital role in maintaining healthy ecosystems by dispersing seeds and recycling nutrients. Unless food is abundant, black bears typically hibernate from November to March. From September, bears enter hyperphagia, during which their calorie intake increases from 5,000 to 20,000 per day.',
                                            icon: 'icon\u002Dblack\u002Dbear',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'mountain\u002Dgoat',
                                            title: '8.2.2 Mountain Goat',
                                            description: 'Mountain goats are iconic alpine specialists, adapted to life on steep cliffs and rugged terrain. With thick white coats, black horns, and muscular builds, they navigate vertical landscapes with ease. Their split hooves and rough pads provide grip on rock faces, allowing them to escape predators and access high\u002Delevation forage. Found throughout BCs mountainous regions, mountain goats are sensitive to disturbance and require undisturbed escape terrain. Their seasonal movements follow snowlines and forage availability, often descending in winter and ascending in summer.',
                                            icon: 'icon\u002Dmountain\u002Dgoat',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://doi.org/10.3389/fenvs.2022.958596\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'black\u002Dtailed\u002Ddeer',
                                            title: '8.2.3 Black\u002DTailed Deer',
                                            description: 'Black\u002Dtailed deer, also known as mule deer, are browsers adapted to BCs coastal rainforests. With reddish\u002Dbrown summer coats and darker winter pelage, theyre named for their distinctive black\u002Dtipped tails. These deer are crepuscular, feeding at dawn and dusk, and rely on dense understory for cover. Males grow forked antlers annually, shedding them in late winter. Black\u002Dtailed deer are a vital prey species for cougars and wolves and play a key role in shaping forest vegetation through browsing.',
                                            icon: 'icon\u002Dblack\u002Dtailed\u002Ddeer',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'small\u002Drange\u002Dlinkages',
                            name: '8.3 Small\u002DRange Linkages',
                            description: 'Corridors for small\u002Dranging species (e.g., shrews, some rodents and herptiles) are on a much finer scale, often consisting of maintained strips of vegetation, brush piles, or even simple culverts that allow movement between adjacent micro\u002Dhabitats. Their design focuses on safe passage over very short distances to avoid local threats such as roads, trails or developed lots. At the local level, they can be integrated into urban design and land use policies. At the regional scale, they help enhance ecosystem resilience to microclimatic changes.',
                            icon: 'icon\u002Dsmall\u002Drange\u002Dcorridors',
                            indicators: [
                                
                                    
                                        {
                                            id: 'hoary\u002Dmarmot',
                                            title: '8.3.1 Hoary Marmot',
                                            description: 'Hoary marmots are large, social ground squirrels known for their loud whistles, which gave Whistler its name, and communal sunbathing. Their thick silver\u002Dgrey fur and white muzzle give them a frosted appearance, hence the name hoary. Marmots live in colonies and dig extensive burrow systems in alpine meadows, where they forage during the short summer season. They hibernate for up to eight months, relying on fat reserves built during peak forage. In BC, hoary marmots are common in high\u002Delevation habitats, including the Garibaldi and Tantalus ranges.',
                                            icon: 'icon\u002Dhoary\u002Dmarmot',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'douglass\u002Dsquirrel',
                                            title: '8.3.2 Douglass Squirrel',
                                            description: 'he Douglas squirrel is a lively, vocal tree squirrel with a rusty brown back, pale belly, bushy tail, and a distinct black side stripe in summer. Known for its rapid movements and sharp chatter, it plays a key role in forest ecosystems by dispersing seeds and spores. These squirrels are active year\u002Dround, caching cones and mushrooms around the forest. They prefer mature coniferous forests, especially those dominated by Douglas\u002Dfir, hemlock, and pine. Their nests, called dreys, are built in tree cavities or branch forks and lined with moss and bark.',
                                            icon: 'icon\u002Ddouglass\u002Dsquirell',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'yellow\u002Dpine\u002Dchipmunk',
                                            title: '8.3.3 Yellow\u002DPine Chipmunk',
                                            description: 'The yellow\u002Dpine chipmunk is a small, agile rodent with bold facial stripes and a reddish\u002Dbrown back. Chipmunks are excellent climbers and often forage in shrubs and low trees. Theyre active during the day, storing food in cheek pouches and caching seeds for winter. Yellow\u002Dpine chipmunks hibernate in colder months, emerging in spring to breed and forage. Their vocalisations include high\u002Dpitched chips and trills used for alarm and territory defence.',
                                            icon: 'icon\u002Dyellow\u002Dpine\u002Dchipmunk',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'garter\u002Dsnake',
                                            title: '8.3.4 Garter Snake',
                                            description: 'Garter snakes are slender, non\u002Dvenomous reptiles with distinctive longitudinal stripes, typically yellow, green, or blue, running down their dark bodies. Males are considerably smaller than females. They are highly adaptable and often found near water, where they hunt amphibians and small fish. Garter snakes are active during the day and hibernate communally in winter, sometimes in large numbers. They give birth to live young and use their keen sense of smell and tongue\u002Dflicking to locate prey. In BC, several subspecies exist, including the common western garter and the more aquatic valley garter. In the Sea\u002Dto\u002DSky the most frequently seen is the common garter snake.',
                                            icon: 'icon\u002Dgarter\u002Dsnake',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'pacific\u002Dtree\u002Dfrog',
                                            title: '8.3.5 Pacific Tree Frog',
                                            description: 'The Pacific Tree frog is a tiny, vocal amphibian known for its loud nighttime calls and remarkable colour variation, ranging from green to brown, with a dark eye stripe. Despite their name, they are technically tree frogs and possess toe pads for climbing. These frogs breed in shallow wetlands and temporary pools, laying eggs in clusters attached to vegetation. After metamorphosis, juveniles disperse into upland habitats. Pacific chorus frogs are active from spring through fall and hibernate in leaf litter or underground during winter.',
                                            icon: 'icon\u002Dpacific\u002Dtree\u002Dfrog',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'western\u002Dtoad',
                                            title: '8.3.6 Western Toad',
                                            description: 'Western toads are stout amphibians with dry, bumpy skin and a pale stripe running down their back. Unlike frogs, they walk rather than hop, and their parotoid glands behind the eyes secrete mild toxins to deter predators. These toads breed in shallow wetlands and lay long strings of eggs. After metamorphosis, juveniles disperse into upland habitats, often traveling hundreds of meters from breeding sites. Western toads are active from spring to fall and hibernate underground during winter.',
                                            icon: 'icon\u002Dwestern\u002Dtoad',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'red\u002Dlegged\u002Dfrog',
                                            title: '8.3.7 Red\u002DLegged Frog',
                                            description: 'Northern red\u002Dlegged frogs are slender, long\u002Dlegged amphibians with smooth skin and a reddish hue on their hind limbs. Their eyes are positioned slightly forward, and they often have a faint gold wash on their back. These frogs breed early in the year, sometimes while snow still lingers, laying egg masses in cool, still wetlands. After metamorphosis, juveniles disperse into moist forest habitats, where they forage and overwinter under logs or in root channels. They are sensitive to habitat disturbance and require cool, shaded environments to thrive.',
                                            icon: 'icon\u002Dred\u002Dlegged\u002Dfrog',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'ensatina\u002Dsalamander',
                                            title: '8.3.8 Ensatina Salamander',
                                            description: 'The Ensatina salamander is a small, lungless amphibian with smooth skin and a constricted tail base. Its coloration varies from reddish\u002Dbrown to orange or gray, often with mottled patterns. Unlike many amphibians, Ensatinas do not have an aquatic larval stage, they hatch directly from eggs laid in moist terrestrial microhabitats. These salamanders breathe through their skin and require cool, damp environments to survive. They are nocturnal and secretive, sheltering under logs, leaf litter, and rocks during the day.',
                                            icon: 'icon\u002Densatina\u002Dsalamander',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'northwestern\u002Dsalamander',
                                            title: '8.3.9 Northwestern Salamander',
                                            description: 'The Northwestern salamander is a secretive amphibian with smooth brown skin and large parotoid glands behind the eyes. Adults are terrestrial, while larvae and juvenile individuals remain aquatic. They breed in still or slow\u002Dmoving water, laying egg masses attached to submerged vegetation. After metamorphosis, juveniles disperse into moist forest habitats, often sheltering under logs, leaf litter, or in burrows. These salamanders are long\u002Dlived and sensitive to habitat disturbance, especially changes in moisture and temperature.',
                                            icon: 'icon\u002Dnorthwest\u002Dsalamander',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'long\u002Dtoed\u002Dsalamander',
                                            title: '8.3.10 Long\u002DToed Salamander',
                                            description: 'The long\u002Dtoed salamander is a slender amphibian with a dark body, yellow or olive dorsal stripe, and notably elongated fourth toe on the hind foot. It breeds in shallow ponds and lakes, laying eggs singly or in small clusters attached to submerged vegetation. Larvae are aquatic, while adults are terrestrial and nocturnal, sheltering under logs, rocks, and leaf litter. These salamanders are active in spring and fall, often migrating short distances between breeding and foraging habitats. Their permeable skin makes them highly sensitive to pollutants and moisture loss.',
                                            icon: 'icon\u002Dlong\u002Dtoed\u002Dsalamander',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        },
                                    
                                
                                    
                                        {
                                            id: 'northern\u002Dalligator\u002Dlizard',
                                            title: '8.3.11 Northern Alligator Lizard',
                                            description: 'Alligator lizards are slender, long\u002Dbodied reptiles with rough scales and a distinctive fold along each side of the body. Their coloration ranges from olive to brown with dark bands, and have the ability to drop their tails to escape predators. These lizards are secretive and often found under logs, rocks, or leaf litter. They are active during warm months and hibernate in winter. Alligator lizards give birth to live young rather than laying eggs, a rare trait among reptiles in BC.',
                                            icon: 'icon\u002Daligator\u002Dlizard',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'wildlife\u002Dcorridors'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        }
                        
                    ],
                    description: 'A clearly defined geographical space where governance, management, and stewardship over the long term sustain or restore effective ecological connectivity while honouring Indigenous stewardship values. Also known as Ecological Corridors in wildland settings or Green Infrastructure Networks in settled areas, these movement pathways link protected and conserved regions and/or unprotected natural habitats. They complement Other effective area\u002Dbased conservation measures (OECMs) and, together, form ecological networks that conserve biodiversity and promote long\u002Dterm ecosystem resilience.',
                    icon: 'icon\u002Dwildlife\u002Dcorridors'

                },
                
                {
                    id: 'resistance\u002Dto\u002Dmovement',
                    name: '9.0 Resistance to Movement',
                    subthemes: [
                        
                        {
                            id: 'barriers',
                            name: '9.1 Barriers',
                            description: 'Landscape features that prevent or severely restrict movement, fragmenting habitats and isolating populations. These can be natural (e.g., large rivers, mountain ranges) but are often human\u002Dmade structures, such as major roads, clusters of buildings, fences, and agricultural clearings. Barriers are modelled as areas of high resistance to movement within a landscape resistance surface, effectively identifying where connectivity linkages are broken or severely compromised. Specific interventions can include installing wildlife crossings (overpasses and underpasses) on roads, removing unnecessary fences, and restoring habitat within narrow corridor sections.',
                            icon: 'icon\u002Dresistance\u002Dto\u002Dmovement',
                            indicators: [
                                
                                    
                                        {
                                            id: 'barriers',
                                            title: '9.1.1 Barriers',
                                            description: 'Landscape features that prevent or severely restrict movement, fragmenting habitats and isolating populations. These can be natural (e.g., large rivers, mountain ranges) but are often human\u002Dmade structures, such as major roads, clusters of buildings, fences, and agricultural clearings. Barriers are modelled as areas of high resistance to movement within a landscape resistance surface, effectively identifying where connectivity linkages are broken or severely compromised. Specific interventions can include installing wildlife crossings (overpasses and underpasses) on roads, removing unnecessary fences, and restoring habitat within narrow corridor sections.',
                                            icon: 'icon\u002Dbarriers',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'resistance\u002Dto\u002Dmovement'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        },
                        
                        {
                            id: 'pinchpoints',
                            name: '9.2 Pinchpoints',
                            description: 'Narrow landscape features that restrict or hinder wildlife movement within an otherwise continuous ecological network. Natural pinch points include sudden topographic changes, such as steep ravines or channelized creeks. Human\u002Dmade pinch points include fencing that physically guides larger mammals into narrow movement paths, and crossing structures, such as culverts and underpasses, that direct the movement of smaller mammals and herptiles across roads and other linear infrastructure features.  Mitigating the adverse effects of these pinch points requires harmonizing land\u002Duse policies across jurisdictional boundaries.',
                            icon: 'icon\u002Dpinchpoints',
                            indicators: [
                                
                                    
                                        {
                                            id: 'pinchpoints',
                                            title: '9.2.1 Pinchpoints',
                                            description: 'Narrow landscape features that restrict or hinder wildlife movement within an otherwise continuous ecological network. Natural pinch points include sudden topographic changes, such as steep ravines or channelized creeks. Human\u002Dmade pinch points include fencing that physically guides larger mammals into narrow movement paths, and crossing structures, such as culverts and underpasses, that direct the movement of smaller mammals and herptiles across roads and other linear infrastructure features.  Mitigating the adverse effects of these pinch points requires harmonizing land\u002Duse policies across jurisdictional boundaries.',
                                            icon: 'icon\u002Dpinchpoints',
                                            map1_url: '',
                                            map2_url: '',
                                            posts: '',
                                            source: '\u003Ca target\u003D\u0022_blank\u0022 href\u003D\u0022https://github.com/S2S\u002DWildlifeConnectivity\u0022\u003ESource\u003C/a\u003E',
                                            unit_of_measure: 'relative index value (0\u002D100)',
                                            theme: 'resistance\u002Dto\u002Dmovement'  // Add theme ID to each indicator
                                        }
                                    
                                
                            ]
                        }
                        
                    ],
                    description: 'Resistance to movement describes the challenges species encounter when traversing a landscape. Human\u002Dmade barriers, such as roads and urban areas, along with natural obstacles like extreme weather and rough terrain, increase resistance and can isolate populations. High resistance reduces ecological connectivity and hampers the natural processes essential for ecosystems to recover from disturbances. This disruption to wildlife movement diminishes ecosystem resilience by impeding species\u0027 ability to migrate to new resources, adapt to climate change, and sustain genetic diversity.',
                    icon: 'icon\u002Dresistance\u002Dto\u002Dmovement'

                }
                
            ];

            // DOM Elements
            const themeDropdown = document.getElementById('themeDropdown');
            const subthemeDropdown = document.getElementById('subthemeDropdown');
            const indicatorDropdown = document.getElementById('indicatorDropdown');
            const themeMenu = document.getElementById('themeMenu');
            const subthemeMenu = document.getElementById('subthemeMenu');
            const indicatorMenu = document.getElementById('indicatorMenu');
            const indicatorTitle = document.querySelector('.indicator-title');
            const indicatorDescription = document.querySelector('.indicator-description');
            const indicatorIcon = document.querySelector('.indicator-icon i');
            const map1Iframe = document.getElementById('map1');
            const map2Iframe = document.getElementById('map2');

            // Current selections
            let currentTheme = null;
            let currentSubtheme = null;
            let currentIndicator = null;
            
            // Function to update URL with current state
            function updateURL() {
                const params = new URLSearchParams();
                if (currentTheme) params.set('theme', currentTheme.id);
                if (currentSubtheme) params.set('subtheme', currentSubtheme.id);
                if (currentIndicator) params.set('indicator', currentIndicator.id);
                
                const newUrl = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
                window.history.pushState({}, '', newUrl);
            }
            
            // Function to find theme by ID
            function findThemeById(themeId) {
                return themesData.find(theme => theme.id === themeId);
            }
            
            // Load state from URL parameters
            function loadStateFromURL() {
                const params = new URLSearchParams(window.location.search);
                const themeId = params.get('theme');
                const subthemeId = params.get('subtheme');
                const indicatorId = params.get('indicator');
                
                if (themeId) {
                    const theme = findThemeById(themeId);
                    if (theme) {
                        // Use setTimeout to ensure dropdowns are initialized
                        setTimeout(() => {
                            selectTheme(theme);
                            
                            if (subthemeId) {
                                // Small delay to ensure theme is processed
                                setTimeout(() => {
                                    const subtheme = theme.subthemes.find(s => s.id === subthemeId);
                                    if (subtheme) {
                                        selectSubtheme(subtheme);
                                        
                                        if (indicatorId) {
                                            // Small delay to ensure subtheme is processed
                                            setTimeout(() => {
                                                const indicator = subtheme.indicators.find(i => i.id === indicatorId);
                                                if (indicator) {
                                                    selectIndicator(indicator);
                                                }
                                            }, 100);
                                        }
                                    }
                                }, 100);
                            }
                        }, 100);
                    }
                }
            }
            
            // Handle browser back/forward buttons
            window.addEventListener('popstate', () => {
                loadStateFromURL();
            });

            // Initialize dropdowns and load state from URL
            function initDropdowns() {
                // Load state from URL after a short delay to ensure DOM is ready
                setTimeout(loadStateFromURL, 100);
                // Populate themes
                themesData.forEach(theme => {
                    const item = createDropdownItem(theme.name, 'folder', () => {
                        selectTheme(theme);
                    });
                    themeMenu.appendChild(item);
                });

                // Close dropdowns when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.dropdown')) {
                        closeAllDropdowns();
                    }
                });

                // Toggle dropdowns on button click
                document.querySelectorAll('.dropdown-toggle').forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const dropdown = this.closest('.dropdown');
                        const isOpen = dropdown.classList.contains('show');
                        closeAllDropdowns();
                        if (!isOpen) {
                            dropdown.classList.add('show');
                        }
                    });
                });
            }

            // Create dropdown item
            function createDropdownItem(text, icon, onClick) {
                const item = document.createElement('a');
                item.href = '#';
                item.className = 'dropdown-item';
                item.innerHTML = `
                    <span>${text}</span>
                `;
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    onClick(e);
                    // Find and close the parent dropdown
                    const dropdown = e.target.closest('.dropdown');
                    if (dropdown && dropdown._dropdownInstance) {
                        dropdown._dropdownInstance.close();
                    } else {
                        // Fallback to close all dropdowns if the instance isn't available
                        closeAllDropdowns();
                    }
                });
                return item;
            }

            // Close all dropdowns
            function closeAllDropdowns() {
                if (typeof Dropdown !== 'undefined' && typeof Dropdown.closeAll === 'function') {
                    Dropdown.closeAll();
                } else {
                    // Fallback for when Dropdown class is not available yet
                    document.querySelectorAll('.dropdown').forEach(dropdown => {
                        dropdown.classList.remove('active');
                        const toggle = dropdown.querySelector('.dropdown-toggle');
                        const chevron = toggle?.querySelector('i.fa-chevron-down');
                        if (toggle) toggle.setAttribute('aria-expanded', 'false');
                        if (chevron) chevron.style.transform = '';
                    });
                }
            }

            // Update theme info box
            function updateThemeInfo(theme) {
                const themeInfo = document.querySelector('.theme-info');
                if (!theme) {
                    themeInfo.innerHTML = `
                        <div class="info-box-title">Theme Information</div>
                        <div class="theme-icon">
                            <i class="fas fa-map-marked-alt"></i>
                        </div>
                        <div class="text-content">
                            <h2 class="theme-title">Map Viewer</h2>
                            <p class="theme-description">Select a theme, subtheme, and indicator to view detailed information.</p>
                        </div>`;
                    return;
                }
                
                themeInfo.innerHTML = `
                    <div class="info-box-title">Theme Information</div>
                    <div class="theme-icon">
                        <i class="icon ${theme.icon}"></i>
                    </div>
                    <div class="text-content">
                        <h2 class="theme-title">${theme.name}</h2>
                        <p class="theme-description">${theme.description}</p>
                    </div>`;
            }

            // Theme selected
            function selectTheme(theme) {
                currentTheme = theme;
                currentSubtheme = null;
                currentIndicator = null;
                
                // Get map elements
                const map1 = document.getElementById('map1');
                const map2 = document.getElementById('map2');
                const mapPlaceholder = document.getElementById('mapPlaceholder');
                
                // Reset map display to show placeholder and hide maps
                if (mapPlaceholder && map1 && map2) {
                    mapPlaceholder.style.display = 'flex';
                    map1.style.display = 'none';
                    map2.style.display = 'none';
                    
                    // Clear map sources
                    map1.src = '';
                    map2.src = '';
                }
                
                // Update theme button
                updateButton(themeDropdown, theme.name, 'folder');
                
                // Reset theme info to default
                const themeInfo = document.querySelector('.theme-info');
                if (themeInfo) {
                    themeInfo.innerHTML = `
                        <div class="info-box-title">Theme Information</div>
                        <div class="theme-icon">
                            <i class="icon ${theme.icon || 'fa-map-marked-alt'}"></i>
                        </div>
                        <div class="text-content">
                            <h2 class="theme-title">${theme.name}</h2>
                            <p class="theme-description">${theme.description}</p>
                        </div>`;
                }
                
                // Reset subtheme dropdown
                updateButton(subthemeDropdown, 'Select Subtheme', 'folder-open');
                
                // Show subtheme dropdown
                subthemeDropdown.style.display = 'block';
                
                // Clear and populate subthemes
                subthemeMenu.innerHTML = '';
                theme.subthemes.forEach(subtheme => {
                    const item = createDropdownItem(subtheme.name, 'folder-open', () => {
                        selectSubtheme(subtheme);
                    });
                    subthemeMenu.appendChild(item);
                });
                
                // Reset and hide indicator dropdown
                updateButton(indicatorDropdown, 'Select Indicator', 'chart-bar');
                indicatorDropdown.style.display = 'none';
                
                // Reset indicator info box to default state
                const indicatorInfo = document.querySelector('.indicator-info');
                if (indicatorInfo) {
                    indicatorInfo.innerHTML = `
                        <div class="info-box-title">Indicator Information</div>
                        <div class="indicator-icon">
                            <i class="icon icon-question"></i>
                        </div>
                        <div class="text-content">
                            <h2 class="indicator-title">Select an Indicator</h2>
                            <p class="indicator-description">Choose a sub-theme first, then select an indicator to view its details.</p>
                        </div>`;
                }
                
                // Reset subtheme info box to default state
                const subthemeInfo = document.querySelector('.subtheme-info');
                if (subthemeInfo) {
                    subthemeInfo.innerHTML = `
                        <div class="info-box-title">Sub-theme Information</div>
                        <div class="subtheme-icon">
                            <i class="icon icon-question"></i>
                        </div>
                        <div class="text-content">
                            <h2 class="subtheme-title">Select a Sub-theme</h2>
                            <p class="subtheme-description">Choose a sub-theme from the dropdown above to view its details.</p>
                        </div>`;
                }
                
                closeAllDropdowns();
            }

            // Subtheme selected
            function selectSubtheme(subtheme) {
                // Reset current indicator
                currentIndicator = null;
                
                // Get map elements
                const map1 = document.getElementById('map1');
                const map2 = document.getElementById('map2');
                const mapPlaceholder = document.getElementById('mapPlaceholder');
                
                // Reset map display to show placeholder and hide maps
                mapPlaceholder.style.display = 'flex';
                map1.style.display = 'none';
                map2.style.display = 'none';
                
                // Clear map sources
                map1.src = '';
                map2.src = '';
                
                // Update current subtheme
                currentSubtheme = subtheme;
                
                // Update subtheme button
                updateButton(subthemeDropdown, subtheme.name, 'folder-open');
                
                // Reset and update indicator button
                updateButton(indicatorDropdown, 'Select Indicator', 'chart-bar');
                
                // Update subtheme info box
                const subthemeInfo = document.querySelector('.subtheme-info');
                if (subthemeInfo) {
                    subthemeInfo.innerHTML = `
                        <div class="info-box-title">Sub-theme Information</div>
                        <div class="subtheme-icon">
                            <i class="icon ${subtheme.icon}"></i>
                        </div>
                        <div class="text-content">
                            <h2 class="subtheme-title">${subtheme.name}</h2>
                            <p class="subtheme-description">${subtheme.description || 'No description available.'}</p>
                        </div>`;
                }
                
                // Reset indicator info box to default state
                const indicatorInfo = document.querySelector('.indicator-info');
                if (indicatorInfo) {
                    indicatorInfo.innerHTML = `
                        <div class="info-box-title">Indicator Information</div>
                        <div class="indicator-icon">
                            <i class="icon icon-question"></i>
                        </div>
                        <div class="text-content">
                            <h2 class="indicator-title">Select an Indicator</h2>
                            <p class="indicator-description">Choose an indicator from the dropdown above to view its details and map.</p>
                        </div>`;
                }
                
                // Show indicator dropdown
                indicatorDropdown.style.display = 'block';
                
                // Clear and populate indicators
                indicatorMenu.innerHTML = '';
                subtheme.indicators.forEach(indicator => {
                    const item = createDropdownItem(indicator.title, indicator.icon.replace('fa-', ''), (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        selectIndicator(indicator);
                    });
                    indicatorMenu.appendChild(item);
                });
                
                // Close all dropdowns using the Dropdown class if available
                if (window.Dropdown) {
                    Dropdown.closeAll();
                } else {
                    closeAllDropdowns();
                }
                
                // Ensure theme info is still showing the parent theme
                if (currentTheme) {
                    updateThemeInfo(currentTheme);
                }
            }

            // Find theme by ID
            function findThemeById(themeId) {
                return themesData.find(theme => theme.id === themeId);
            }

            // Indicator selected
            function selectIndicator(indicator) {
                currentIndicator = indicator;
                
                // Update indicator button
                updateButton(indicatorDropdown, indicator.title, indicator.icon.replace('fa-', ''));
                
                // Close the dropdown directly using the element's instance
                const dropdownElement = document.querySelector('.dropdown.active');
                if (dropdownElement && dropdownElement._dropdownInstance) {
                    dropdownElement._dropdownInstance.close();
                } else {
                    // Fallback to class-based closing if instance not found
                    document.querySelectorAll('.dropdown').forEach(dropdown => {
                        dropdown.classList.remove('active');
                        const toggle = dropdown.querySelector('.dropdown-toggle');
                        if (toggle) {
                            toggle.setAttribute('aria-expanded', 'false');
                            const chevron = toggle.querySelector('i.fa-chevron-down');
                            if (chevron) chevron.style.transform = '';
                        }
                    });
                }
                
                // Update indicator info box
                const indicatorInfo = document.querySelector('.indicator-info');
                let unitsHtml = indicator.unit_of_measure ? `<span class="indicator-meta-head"><strong>Units:</strong></span><span class="indicator-meta-body"> ${indicator.unit_of_measure}  |  </span>` : '';
                let sourceHtml = indicator.source ? `<span class="indicator-meta-head"><strong>Source:</strong></span><span class="indicator-meta-body"> ${indicator.source}</span>` : '';
                let metaHtml = '';
                
                if (indicator.source || indicator.unit_of_measure) {
                    metaHtml = `<div class="indicator-meta-container">${unitsHtml}${sourceHtml}</div>`;
                }
                
                indicatorInfo.innerHTML = `
                    <div class="info-box-header">
                        <div class="info-box-title">Indicator Information</div>
                        <div class="indicator-icon">
                            <i class="icon ${indicator.icon} indicator-icon"></i>
                        </div>
                    </div>
                    <div class="text-content">
                        <h2 class="indicator-title">${indicator.title}</h2>
                        <p class="indicator-description">${indicator.description}</p>
                        <div class="meta-info">${metaHtml}</div>
                    </div>`;
                
                // Find and update the current theme based on the indicator's theme ID
                if (indicator.theme) {
                    const theme = findThemeById(indicator.theme);
                    if (theme) {
                        currentTheme = theme;
                        updateThemeInfo(theme);
                        // Also update the theme dropdown to show the correct theme
                        updateButton(themeDropdown, theme.name, 'folder');
                    }
                } else if (currentTheme) {
                    // Fallback to current theme if no theme ID in indicator
                    updateThemeInfo(currentTheme);
                }
                
                // Get map elements
                const map1 = document.getElementById('map1');
                const map2 = document.getElementById('map2');
                const mapPlaceholder = document.getElementById('mapPlaceholder');
                
                if (indicator && indicator.map1_url) {
                    // Get the loading spinner
                    const loadingSpinner = document.getElementById('loadingSpinner');
                    
                    // Hide the placeholder and show the loading spinner
                    mapPlaceholder.style.display = 'none';
                    loadingSpinner.style.display = 'flex';
                    
                    // Hide any previously shown map
                    map1.style.display = 'none';
                    
                    // Set up map1 with load event to hide spinner and show map
                    map1.onload = function() {
                        loadingSpinner.style.display = 'none';
                        map1.style.display = 'block';
                    };
                    
                    // Set up error handling
                    map1.onerror = function() {
                        loadingSpinner.style.display = 'none';
                        mapPlaceholder.style.display = 'flex';
                        console.error('Failed to load map');
                    };
                    
                    // Start loading the map after a small delay to ensure spinner is visible
                    setTimeout(() => {
                        map1.src = indicator.map1_url;
                    }, 50);
                    
                    // Set up map2 if URL exists
                    if (indicator.map2_url) {
                        map2.onload = function() {
                            // Additional map2 loaded logic if needed
                        };
                        map2.src = indicator.map2_url;
                        map2.style.display = 'none'; // Will be shown when toggled
                    } else {
                        map2.style.display = 'none';
                    }
                    
                    // Set active view to explore
                    if (exploreLabel) exploreLabel.classList.add('active');
                    if (analyzeLabel) analyzeLabel.classList.remove('active');
                    if (toggleSwitch) toggleSwitch.checked = false;
                    currentView = 'explore';
                } else {
                    // No map URL, show placeholder
                    mapPlaceholder.style.display = 'flex';
                    map1.style.display = 'none';
                    map2.style.display = 'none';
                }
                
                // Update URL without page reload
                window.history.pushState({}, '', indicator.url);
                
                // Close all dropdowns
                if (window.Dropdown) {
                    Dropdown.closeAll();
                } else {
                    closeAllDropdowns();
                }
            }

            // Update dropdown button content
            function updateButton(dropdown, text, icon) {
                const button = dropdown.querySelector('.dropdown-toggle');
                button.innerHTML = `
                    <span>${text}</span>
                    <i class="fas fa-chevron-down" style="font-size: 12px; margin-left: 8px; transition: transform 0.2s ease;"></i>
                `;
            }

            // Initialize the dropdowns
            initDropdowns();
        });
        document.addEventListener('DOMContentLoaded', function() {
          const resourcesButton = document.getElementById('resourcesButton');
          
          resourcesButton.addEventListener('click', function() {
            try {
              // Send a message to the parent window to navigate to the resources section
              window.parent.postMessage({
                type: 'NAVIGATE_TO_RESOURCES',
                target: 'newdev.naturesquamish.ca'  // Target origin for verification
              }, '*');
              
              // Also update the parent URL if we're not in an iframe (for testing)
              if (window === window.top) {
                const currentUrl = window.location.href.split('#')[0];
                window.location.href = currentUrl + '#resources';
              }
            } catch (e) {
              console.error('Error navigating to resources:', e);
            }
          });
          
          // Optional: Listen for a response from the parent
          window.addEventListener('message', function(event) {
            // Verify the message is from a trusted origin
            if (event.origin === 'https://newdev.naturesquamish.ca') {
              if (event.data.type === 'NAVIGATION_COMPLETE') {
                console.log('Successfully navigated to resources section');
              }
            }
          });
        });
      </script>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Enhanced dropdown functionality
            class Dropdown {
                constructor(element) {
                    this.element = element;
                    this.toggle = element.querySelector('.dropdown-toggle');
                    this.menu = element.querySelector('.dropdown-menu');
                    this.chevron = this.toggle.querySelector('i');
                    this.isOpen = false;
                    this.menuItems = Array.from(this.menu.querySelectorAll('a'));
                    this.focusedIndex = -1;
                    
                    this.initialize();
                }
                
                initialize() {
                    // Add ARIA attributes
                    this.toggle.setAttribute('aria-haspopup', 'true');
                    this.toggle.setAttribute('aria-expanded', 'false');
                    
                    // Toggle dropdown on click
                    this.toggle.addEventListener('click', (e) => this.toggleDropdown(e));
                    
                    // Close when clicking outside
                    document.addEventListener('click', (e) => this.handleOutsideClick(e));
                    
                    // Handle keyboard navigation
                    this.toggle.addEventListener('keydown', (e) => this.handleToggleKeyDown(e));
                    this.menu.addEventListener('keydown', (e) => this.handleMenuKeyDown(e));
                    
                    // Handle menu item interactions
                    this.menuItems.forEach((item, index) => {
                        item.addEventListener('click', () => this.close());
                        item.addEventListener('focus', () => this.focusedIndex = index);
                    });
                }
                
                toggleDropdown(e) {
                    e.stopPropagation();
                    
                    if (this.isOpen) {
                        this.close();
                    } else {
                        this.open();
                    }
                }
                
                open() {
                    if (this.isOpen) return;
                    
                    // Close other dropdowns first
                    Dropdown.closeAll(this);
                    
                    // Open this dropdown
                    this.element.classList.add('active');
                    this.toggle.setAttribute('aria-expanded', 'true');
                    this.chevron.style.transform = 'rotate(180deg)';
                    this.isOpen = true;
                    
                    // Focus first item if available
                    if (this.menuItems.length > 0) {
                        this.focusedIndex = 0;
                        this.menuItems[0].focus();
                    }
                }
                
                close() {
                    if (!this.isOpen) return;
                    
                    this.element.classList.remove('active');
                    this.toggle.setAttribute('aria-expanded', 'false');
                    this.chevron.style.transform = '';
                    this.isOpen = false;
                    this.focusedIndex = -1;
                    
                    // Return focus to toggle
                    this.toggle.focus();
                }
                
                handleOutsideClick(e) {
                    if (!this.element.contains(e.target)) {
                        this.close();
                    }
                }
                
                handleToggleKeyDown(e) {
                    const { key } = e;
                    
                    if (key === 'Enter' || key === ' ' || key === 'ArrowDown' || key === 'Down') {
                        e.preventDefault();
                        this.open();
                    } else if (key === 'Escape') {
                        this.close();
                    } else if (key === 'ArrowUp' || key === 'Up') {
                        e.preventDefault();
                        this.open();
                        if (this.menuItems.length > 0) {
                            this.focusedIndex = this.menuItems.length - 1;
                            this.menuItems[this.focusedIndex].focus();
                        }
                    }
                }
                
                handleMenuKeyDown(e) {
                    const { key } = e;
                    
                    switch (key) {
                        case 'Escape':
                            e.preventDefault();
                            this.close();
                            break;
                            
                        case 'ArrowDown':
                        case 'Down':
                            e.preventDefault();
                            this.focusNextItem();
                            break;
                            
                        case 'ArrowUp':
                        case 'Up':
                            e.preventDefault();
                            this.focusPrevItem();
                            break;
                            
                        case 'Home':
                            e.preventDefault();
                            this.focusItem(0);
                            break;
                            
                        case 'End':
                            e.preventDefault();
                            this.focusItem(this.menuItems.length - 1);
                            break;
                            
                        case 'Tab':
                            if (!e.shiftKey && this.focusedIndex === this.menuItems.length - 1) {
                                // Close dropdown when tabbing out of the last item
                                this.close();
                            } else if (e.shiftKey && this.focusedIndex <= 0) {
                                // Close dropdown when shift+tabbing out of the first item
                                e.preventDefault();
                                this.close();
                            }
                            break;
                    }
                }
                
                focusNextItem() {
                    this.focusedIndex = (this.focusedIndex + 1) % this.menuItems.length;
                    this.menuItems[this.focusedIndex].focus();
                }
                
                focusPrevItem() {
                    this.focusedIndex = (this.focusedIndex - 1 + this.menuItems.length) % this.menuItems.length;
                    this.menuItems[this.focusedIndex].focus();
                }
                
                focusItem(index) {
                    if (index >= 0 && index < this.menuItems.length) {
                        this.focusedIndex = index;
                        this.menuItems[index].focus();
                    }
                }
                
                static closeAll(exceptDropdown = null) {
                    document.querySelectorAll('.dropdown').forEach(dropdown => {
                        const instance = dropdown._dropdownInstance;
                        if (instance && instance !== exceptDropdown) {
                            instance.close();
                        }
                    });
                }
            }
            
            // Initialize all dropdowns on the page
            document.querySelectorAll('.dropdown').forEach(dropdown => {
                dropdown._dropdownInstance = new Dropdown(dropdown);
            });
            
            // Update the map iframe source and show the map
            const map1 = document.getElementById('map1');
            const map2 = document.getElementById('map2');
            const mapPlaceholder = document.getElementById('mapPlaceholder');
            
            if (map1 && map2 && mapPlaceholder) {
                if (subTheme && indicator && indicator.map1_url) {
                    map1.src = indicator.map1_url;
                    // Show map1, hide map2
                    map1.style.display = 'block';
                    map2.style.display = 'none';
                    exploreLabel.classList.add('active');
                    analyzeLabel.classList.remove('active');
                    toggleSwitch.checked = false;
                    currentView = 'explore';
                } else {
                    // Show map2, hide map1
                    map1.style.display = 'none';
                    map2.style.display = 'block';
                    exploreLabel.classList.remove('active');
                    analyzeLabel.classList.add('active');
                    toggleSwitch.checked = true;
                    currentView = 'analyze';
                }
            }

            toggleSwitch.addEventListener('change', function() {
                if (this.checked) {
                    switchView('analyze');
                } else {
                    switchView('explore');
                }
            });

            // Also make the labels clickable
            exploreLabel.addEventListener('click', function() {
                if (currentView !== 'explore') {
                    switchView('explore');
                }
            });

            analyzeLabel.addEventListener('click', function() {
                if (currentView !== 'analyze') {
                    switchView('analyze');
                }
            });

            // Fetch WordPress posts with tag 'indicator one'
            const postsContainer = document.getElementById('postsList');
            const loadingElement = document.getElementById('loadingPosts');
            
            // Debug function to log API responses
            async function debugFetch(url) {
                try {
                    console.log('Fetching:', url);
                    const response = await fetch(url);
                    const data = await response.json();
                    console.log('Response from', url, ':', data);
                    return { response, data };
                } catch (error) {
                    console.error('Error in debugFetch:', error);
                    throw error;
                }
            }
            
            // Function to format date
            function formatDate(dateString) {
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return new Date(dateString).toLocaleDateString(undefined, options);
            }
            
            // Function to strip HTML tags and limit excerpt length
            function stripHtml(html, maxLength = 100) {
                const tmp = document.createElement('div');
                tmp.innerHTML = html;
                let text = tmp.textContent || tmp.innerText || '';
                
                // Trim and limit length
                text = text.trim();
                if (text.length > maxLength) {
                    text = text.substring(0, maxLength).trim() + '...';
                }
                return text;
            }

            // Function to create a clean excerpt from content
            function createExcerpt(html) {
                if (!html) return '';
                // Create temporary element to parse HTML
                const tmp = document.createElement('div');
                tmp.innerHTML = html;
                // Get text content and clean it up
                let text = tmp.textContent || tmp.innerText || '';
                // Remove any 'Time to read' patterns
                text = text.replace(/Time\s*to\s*read[^\w]*/gi, '');
                // Clean up the text
                return text
                    .replace(/\s+/g, ' ')      // Replace multiple spaces
                    .trim()                     // Trim whitespace
                    .substring(0, 150)          // Limit length
                    .replace(/\s+\S*$/, '')    // Cut at word boundary
                    .replace(/[\-|:]+$/, '') // Remove trailing punctuation
                    .trim() + '...';            // Add ellipsis
            }

            // Store carousel state to prevent memory leaks
            let carouselState = {
                resizeObserver: null,
                resizeTimeout: null,
                currentIndex: 0,
                cardWidth: 0,
                cards: []
            };

            // Clean up event listeners and observers
            function cleanupCarousel() {
                if (carouselState.resizeObserver) {
                    carouselState.resizeObserver.disconnect();
                }
                window.removeEventListener('resize', handleResize);
                clearTimeout(carouselState.resizeTimeout);
            }

            // Debounced resize handler
            function handleResize() {
                clearTimeout(carouselState.resizeTimeout);
                carouselState.resizeTimeout = setTimeout(() => {
                    updateCarouselSize();
                    updateCarouselPosition();
                }, 100);
            }

            // Update carousel size and card measurements
            function updateCarouselSize() {
                const carousel = document.getElementById('carousel');
                if (!carousel || !carouselState.cards.length) return;
                
                const card = carouselState.cards[0];
                const cardStyle = window.getComputedStyle(card);
                carouselState.cardWidth = card.offsetWidth + 
                    parseInt(cardStyle.marginLeft) + 
                    parseInt(cardStyle.marginRight);
                
                updateCarouselPosition();
            }

            // Update carousel position
            function updateCarouselPosition() {
                const carousel = document.getElementById('carousel');
                if (!carousel) return;
                
                carousel.scrollTo({
                    left: carouselState.currentIndex * carouselState.cardWidth,
                    behavior: 'smooth'
                });
                updateButtons();
            }

            // Update navigation buttons
            function updateButtons() {
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                if (!prevBtn || !nextBtn) return;
                
                prevBtn.style.display = carouselState.currentIndex === 0 ? 'none' : 'flex';
                nextBtn.style.display = carouselState.currentIndex >= carouselState.cards.length - 1 ? 'none' : 'flex';
            }

            // Initialize carousel
            function initCarousel() {
                cleanupCarousel();
                
                const carousel = document.getElementById('carousel');
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                
                if (!carousel || !prevBtn || !nextBtn) {
                    console.warn('Carousel elements not found');
                    return;
                }
                
                carouselState.cards = Array.from(document.querySelectorAll('.post-card'));
                if (!carouselState.cards.length) return;
                
                // Initial setup
                updateCarouselSize();
                updateButtons();
                
                // Event listeners
                prevBtn.addEventListener('click', () => {
                    if (carouselState.currentIndex > 0) {
                        carouselState.currentIndex--;
                        updateCarouselPosition();
                    }
                });
                
                nextBtn.addEventListener('click', () => {
                    if (carouselState.currentIndex < carouselState.cards.length - 1) {
                        carouselState.currentIndex++;
                        updateCarouselPosition();
                    }
                });
                
                // Resize observer for better performance
                carouselState.resizeObserver = new ResizeObserver(handleResize);
                carouselState.resizeObserver.observe(document.body);
                
                // Initial position
                updateCarouselPosition();
            }

            // Fetch posts from WordPress REST API with improved error handling
            async function fetchWordPressPosts(indicator) {
                const postsContainer = document.getElementById('posts-container');
                const loadingElement = document.getElementById('loading-indicator');
                
                // Clean up previous carousel
                cleanupCarousel();
                
                // Reset state
                carouselState = {
                    resizeObserver: null,
                    resizeTimeout: null,
                    currentIndex: 0,
                    cardWidth: 0,
                    cards: []
                };
                
                // Show loading state
                if (loadingElement) loadingElement.style.display = 'block';
                if (postsContainer) {
                    postsContainer.innerHTML = '';
                    postsContainer.style.display = 'block';
                }
                
                try {
                    if (!indicator || !indicator.posts) {
                        console.log('No posts filter defined for this indicator');
                        if (postsContainer) postsContainer.innerHTML = '<p>No posts configuration found for this indicator.</p>';
                        return;
                    }

                    // Convert the posts string to a slug format
                    const tagSlug = indicator.posts.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
                    console.log('Searching for WordPress posts with tag slug:', tagSlug);
                    
                    // Add timeout for the fetch request
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                    
                    // First, get the tag ID for the indicator's posts
                    const tagResponse = await fetch(
                        `https://newdev.naturesquamish.ca/wp-json/wp/v2/tags?slug=${tagSlug}`,
                        { signal: controller.signal }
                    );
                    clearTimeout(timeoutId);
                    
                    if (!tagResponse.ok) {
                        throw new Error(`HTTP error! status: ${tagResponse.status}`);
                    }
                    
                    const tags = await tagResponse.json();
                    console.log('Found matching tags:', tags);
                    
                    if (!tags || tags.length === 0) {
                        console.warn(`No matching tags found for: ${tagSlug}`);
                        if (postsContainer) postsContainer.innerHTML = `<p>No posts found for: ${indicator.posts}</p>`;
                        return;
                    }
                    
                    const tagId = tags[0].id;
                    console.log(`Found tag ID ${tagId} for "${tagSlug}"`);
                    
                    // Fetch posts with excerpts and featured image
                    const postsResponse = await fetch(
                        `https://newdev.naturesquamish.ca/wp-json/wp/v2/posts?tags=${tagId}` +
                        `&_fields=id,title,link,date,excerpt,featured_media` +
                        `&_embed=wp:featuredmedia` +
                        `&per_page=3`,
                        { signal: controller.signal }
                    );
                    
                    if (!postsResponse.ok) {
                        throw new Error(`Failed to fetch posts: ${postsResponse.statusText}`);
                    }
                    
                    const posts = await postsResponse.json();
                    console.log(`Fetched ${posts.length} posts for tag ID ${tagId}`);
                    
                    if (posts.length === 0) {
                        if (postsContainer) postsContainer.innerHTML = '<p>No updates available at the moment.</p>';
                        return;
                    }
                    
                    // Generate HTML for each post
                    const postsHtml = `
                        <div class="carousel-container" id="carousel">
                            ${posts.map(post => {
                                const featuredImage = post._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
                                // Use WordPress excerpt directly and clean it up
                                let excerpt = post.excerpt?.rendered ? stripHtml(post.excerpt.rendered) : 'No description available';
                                // Add space after 'Time to read' if it exists
                                excerpt = excerpt.replace(/(Time\s*to\s*read[^<]*)([^\s])/gi, '$1 $2');
                                
                                return `
                                    <article class="post-card">
                                        ${featuredImage ? `<div class="post-image" style="background-image: url('${featuredImage}')"></div>` : ''}
                                        <div class="post-content">
                                            <h3 class="post-title">${post.title.rendered}</h3>
                                            <div class="post-meta">Posted on ${formatDate(post.date)}</div>
                                            ${excerpt ? `<p class="post-excerpt">${excerpt}</p>` : ''}
                                            <a href="${post.link}" class="post-link" target="_blank" rel="noopener noreferrer">Read more </a>
                                        </div>
                                    </article>
                                `;
                            }).join('')}
                        </div>
                        <button id="prevBtn" class="carousel-nav prev" aria-label="Previous"></button>
                        <button id="nextBtn" class="carousel-nav next" aria-label="Next"></button>
                    `;
            
                    // Initialize carousel after posts are loaded
                    if (postsContainer) {
                        // Use requestAnimationFrame for smoother updates
                        requestAnimationFrame(() => {
                            postsContainer.innerHTML = postsHtml;
                            
                            // Initialize carousel on next frame
                            requestAnimationFrame(() => {
                                initCarousel();
                                
                                // Force a reflow to ensure styles are applied
                                void postsContainer.offsetHeight;
                                
                                // Show the container
                                postsContainer.style.opacity = '1';
                            });
                        });
                    }
                    
                    
                } catch (error) {
                    console.error('Error fetching WordPress posts:', error);
                    const errorMessage = error.name === 'AbortError' 
                        ? 'Request timed out. Please check your connection and try again.'
                        : 'Unable to load updates at this time. Please try again later.';
                    
                    if (postsContainer) {
                        postsContainer.innerHTML = `
                            <div class="error-message">
                                <p>${errorMessage}</p>
                                <button onclick="window.location.reload()" class="retry-button">
                                    <i class="fas fa-sync-alt"></i> Retry
                                </button>
                            </div>
                        `;
                    }
                } finally {
                    if (loadingElement) loadingElement.style.display = 'none';
                }
            }
            
            // Fetch posts when the page loads with the current indicator's data
            const currentIndicator = {
                posts: '',
                title: ''
            };
            fetchWordPressPosts(currentIndicator);
        });
    </script>
</body>
</html>
